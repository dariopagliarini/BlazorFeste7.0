"use strict";!function(e,r){var n;"function"==typeof define&&define.amd?define(function(e,n,t){r(n)}):("object"==typeof module&&module.exports||(n=(n=(n=e.DevExpress=e.DevExpress||{}).viz=n.viz||{}).vectormaputils={}),r(n))}(this,function(e){function l(){}function p(e){return e}function f(e){return"function"==typeof e}function i(e){var n=new DataView(e),t=0,r={pos:function(){return t},skip:function(e){return t+=e,r},ui8arr:function(e){var n=0,t=[];for(t.length=e;n<e;++n)t[n]=r.ui8();return t},ui8:function(){e=t;var e=n.getUint8(e);return t+=1,e},ui16LE:function(){e=t;var e=n.getUint16(e,!0);return t+=2,e},ui32LE:function(){e=t;var e=n.getUint32(e,!0);return t+=4,e},ui32BE:function(){e=t;var e=n.getUint32(e,!1);return t+=4,e},f64LE:function(){e=t;var e=n.getFloat64(e,!0);return t+=8,e}};return r}function h(e,n,t){var r,o=e[0]?function(e,n){var t,r,o,i,u,s,a,c,l,p,f,h,d,g=[];try{t=new Date,(s={}).fileCode=(u=e).ui32BE(),u.skip(20),s.fileLength=u.ui32BE()<<1,s.version=u.ui32LE(),s.type_number=u.ui32LE(),s.type=y[s.type_number],s.bBox_XY=P(u),s.bBox_ZM=M(u,2),o=s}catch(e){return void n.push("shp: header parsing error: "+e.message+" / "+e.description)}9994!==o.fileCode&&n.push("shp: file code: "+o.fileCode+" / expected: 9994"),1e3!==o.version&&n.push("shp: file version: "+o.version+" / expected: 1000");try{for(;e.pos()<o.fileLength&&(a=e,c=o.type,l=n,d=h=f=p=void 0,p={number:a.ui32BE()},f=a.ui32BE()<<1,h=a.pos(),d=a.ui32LE(),p.type_number=d,p.type=y[d],p.geoJSON_type=m[p.type],p.type?(p.type!==c&&l.push("shp: shape #"+p.number+" type: "+p.type+" / expected: "+c),v[d](a,p),(h=a.pos()-h)!=f&&l.push("shp: shape #"+p.number+" length: "+f+" / actual: "+h)):(l.push("shp: shape #"+p.number+" type: "+d+" / unknown"),p=null),i=p);)g.push(i);e.pos()!==o.fileLength&&n.push("shp: file length: "+o.fileLength+" / actual: "+e.pos()),r=new Date}catch(e){n.push("shp: records parsing error: "+e.message+" / "+e.description)}return{bBox:o.bBox_XY,type:o.shapeType,shapes:g,errors:n,time:r-t}}(i(e[0]),t):{},e=e[1]?function(e,n){var t,r,o,i,u;try{t=new Date,i=function(e,n){for(var t,r,o=[],i=0,u=e.fields.length,s=0,i=0;i<u;++i)(t={name:(r=e.fields[i]).name,parser:c[r.type],length:r.length}).parser||(t.parser=E,n.push("dbf: field "+r.name+" type: "+r.type+" / unknown")),s+=r.length,o.push(t);return s+1!==e.recordLength&&n.push("dbf: record length: "+e.recordLength+" / actual: "+(s+1)),o}(o=function(e,n){var t,r,o,i,u={versionNumber:e.ui8(),lastUpdate:new Date(1900+e.ui8(),e.ui8()-1,e.ui8()),numberOfRecords:e.ui32LE(),headerLength:e.ui16LE(),recordLength:e.ui16LE(),fields:[]};for(e.skip(20),t=(u.headerLength-e.pos()-1)/32;0<t;--t)u.fields.push((i=void 0,i={name:a(o=e,11).replace(/\0*$/gi,""),type:s(o.ui8()),length:o.skip(4).ui8(),count:o.ui8()},o.skip(14),i));return 13!==(r=e.ui8())&&n.push("dbf: header terminator: "+r+" / expected: 13"),u}(e,n),n),u=function(e,n,t,r,o){for(var i,u,s,a,c=r.length,l=[],p=0;p<n;++p){for(s={},u=e.pos(),e.skip(1),i=0;i<c;++i)s[(a=r[i]).name]=a.parser(e,a.length);(u=e.pos()-u)!==t&&o.push("dbf: record #"+(p+1)+" length: "+t+" / actual: "+u),l.push(s)}return l}(e,o.numberOfRecords,o.recordLength,i,n),r=new Date}catch(e){n.push("dbf: parsing error: "+e.message+" / "+e.description)}return{records:u,errors:n,time:r-t}}(i(e[1]),t):{},t=function(e,n,t){for(var r,o=[],i=o.length=Math.max(e.length,n.length),u=0;u<i;++u)r=e[u]||{},o[u]={type:"Feature",geometry:{type:r.geoJSON_type||null,coordinates:r.coordinates?t(r.coordinates):[]},properties:n[u]||null};return o}(o.shapes||[],e.records||[],n);return t.length?(r={type:"FeatureCollection",features:t}).bbox=o.bBox:r=null,r}function n(e,n){var t,r=P(e),o=g(e),i=g(e),u=b(e,o),s=M(e,i),a=[];for(a.length=o,t=0;t<o;++t)a[t]=s.slice(u[t],u[t+1]||i);n.bBox=r,n.coordinates=a}function t(e,n){var t,r,o,i=P(e),u=g(e),s=g(e),a=b(e,u),c=M(e,s),l=x(e),p=L(e,s),f=[];for(f.length=u,t=0;t<u;++t)r=a[t],o=a[t+1]||s,f[t]=d(c.slice(r,o),p.slice(r,o),o-r);n.bBox=i,n.mBox=l,n.coordinates=f}function r(e,n){var t,r,o,i=P(e),u=g(e),s=g(e),a=b(e,u),c=M(e,s),l=x(e),p=L(e,s),f=x(e),h=L(e,s),d=[];for(d.length=u,t=0;t<u;++t)r=a[t],o=a[t+1]||s,d[t]=B(c.slice(r,o),p.slice(r,o),h.slice(r,o),o-r);n.bBox=i,n.zBox=l,n.mBox=f,n.coordinates=d}e.parse=function(e,t,r){var o,i,u,s,a;return a=(a=e)||{},e=["shp","dbf"].map(function(o){return function(t){var e,n,r;a.substr?(o="."+o,e=a+(a.substr(-o.length).toLowerCase()===o?"":o),n=function(e,n){t(e,n)},(r=new XMLHttpRequest).addEventListener("load",function(){n(this.response?null:this.statusText,this.response)}),r.open("GET",e),r.responseType="arraybuffer",r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(null)):t(null,a[o]||null)}}),i=[],u=[],s=1,e.forEach(function(e,t){++s,e(function(e,n){i[t]=e,u[t]=n,c()})}),c(),o;function c(){var e,n;0==--s&&(e=u,r=f(t)&&t||f(r)&&r||l,t=!f(t)&&t||{},n=[],i.forEach(function(e){e&&n.push(e)}),o=h(e,0<=t.precision?function(e){var n=Number("1E"+e);function t(e){return Math.round(e*n)/n}return function e(n){return n.map(n[0].length?e:t)}}(t.precision):p,n),r(o,n.length?n:null))}};var y={0:"Null",1:"Point",3:"PolyLine",5:"Polygon",8:"MultiPoint",11:"PointZ",13:"PolyLineZ",15:"PolygonZ",18:"MultiPointZ",21:"PointM",23:"PolyLineM",25:"PolygonM",28:"MultiPointM",31:"MultiPatch"},v={0:l,1:function(e,n){n.coordinates=M(e,1)[0]},3:n,5:n,8:function(e,n){n.bBox=P(e),n.coordinates=M(e,g(e))},11:function(e,n){n.coordinates=M(e,1)[0],n.push(L(e,1)[0],L(e,1)[0])},13:r,15:r,18:function(e,n){var t=P(e),r=g(e),o=M(e,r),i=x(e),u=L(e,r),s=x(e),e=L(e,r);n.bBox=t,n.zBox=i,n.mBox=s,n.coordinates=B(o,u,e,r)},21:function(e,n){n.coordinates=M(e,1)[0],n.coordinates.push(L(e,1)[0])},23:t,25:t,28:function(e,n){var t=P(e),r=g(e),o=M(e,r),i=x(e),e=L(e,r);n.bBox=t,n.mBox=i,n.coordinates=d(o,e,r)},31:function(e,n){var t,r,o,i=P(e),u=g(e),s=g(e),a=b(e,u),c=b(e,u),l=M(e,s),p=x(e),f=L(e,s),e=x(e),h=[];for(h.length=u,t=0;t<u;++t)r=a[t],o=a[t+1]||s,h[t]=B(l.slice(r,o),f.slice(r,o),mValues.slice(r,o),o-r);n.bBox=i,n.zBox=p,n.mBox=e,n.types=c,n.coordinates=h}},m={Null:"Null",Point:"Point",PolyLine:"MultiLineString",Polygon:"Polygon",MultiPoint:"MultiPoint",PointZ:"Point",PolyLineZ:"MultiLineString",PolygonZ:"Polygon",MultiPointZ:"MultiPoint",PointM:"Point",PolyLineM:"MultiLineString",PolygonM:"Polygon",MultiPointM:"MultiPoint",MultiPatch:"MultiPatch"};function g(e){return e.ui32LE()}function b(e,n){var t,r=[];for(r.length=n,t=0;t<n;++t)r[t]=g(e);return r}function L(e,n){var t,r=[];for(r.length=n,t=0;t<n;++t)r[t]=e.f64LE();return r}function P(e){return L(e,4)}function x(e){return[e.f64LE(),e.f64LE()]}function M(e,n){var t,r=[];for(r.length=n,t=0;t<n;++t)r[t]=x(e);return r}function d(e,n,t){var r,o=[];for(o.length=t,r=0;r<t;++r)o[r]=[e[r][0],e[r][1],n[r]];return o}function B(e,n,t,r){var o,i=[];for(i.length=r,o=0;o<r;++o)i[o]=[e[o][0],e[o][1],n[o],t[o]];return i}var s=String.fromCharCode;function a(e,n){return s.apply(null,e.ui8arr(n))}var c={C:function(e,n){n=a(e,n);try{n=decodeURIComponent(escape(n))}catch(e){}return n.trim()},N:function(e,n){e=a(e,n);return parseFloat(e)},D:function(e,n){e=a(e,n);return new Date(e.substring(0,4),e.substring(4,6)-1,e.substring(6,8))}};function E(e,n){return e.skip(n),null}});