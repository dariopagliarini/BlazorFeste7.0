import{Element,defaults,Animations,Chart}from"chart.js";import{distanceBetweenPoints,defined,isFunction,callback,isObject,valueOrDefault,toRadians,isArray,toFont,addRoundedRectPath,toTRBLCorners,QUARTER_PI,PI,HALF_PI,TWO_THIRDS_PI,TAU,isNumber,RAD_PER_DEG,toPadding,isFinite,toDegrees,clipArea,unclipArea}from"chart.js/helpers";const interaction={modes:{point(e,t){return filterElements(e,t,{intersect:!0})},nearest(e,t,o){return getNearestItem(e,t,o)},x(e,t,o){return filterElements(e,t,{intersect:o.intersect,axis:"x"})},y(e,t,o){return filterElements(e,t,{intersect:o.intersect,axis:"y"})}}};function getElements(e,t,o){const n=interaction.modes[o.mode]||interaction.modes.nearest;return n(e,t,o)}function inRangeByAxis(e,t,o){return"x"!==o&&"y"!==o?e.inRange(t.x,t.y,"x",!0)||e.inRange(t.x,t.y,"y",!0):e.inRange(t.x,t.y,o,!0)}function getPointByAxis(e,t,o){return"x"===o?{x:e.x,y:t.y}:"y"===o?{x:t.x,y:e.y}:t}function filterElements(e,t,o){return e.visibleElements.filter(e=>o.intersect?e.inRange(t.x,t.y):inRangeByAxis(e,t,o.axis))}function getNearestItem(e,n,i){let r=Number.POSITIVE_INFINITY;return filterElements(e,n,i).reduce((e,t)=>{var o=t.getCenterPoint(),o=getPointByAxis(n,o,i.axis),o=distanceBetweenPoints(n,o);return o<r?(e=[t],r=o):o===r&&e.push(t),e},[]).sort((e,t)=>e._index-t._index).slice(0,1)}const isOlderPart=(e,t)=>e<t||e.length>t.length&&e.slice(0,t.length)===t,EPSILON=.001,clamp=(e,t,o)=>Math.min(o,Math.max(t,e));function clampAll(e,t,o){for(const n of Object.keys(e))e[n]=clamp(e[n],t,o);return e}function inPointRange(e,t,o,n){if(!e||!t||o<=0)return!1;n/=2;return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)<=Math.pow(o+n,2)}function inBoxRange(e,{x:t,y:o,x2:n,y2:i},r,a){a/=2,t=e.x>=t-a-EPSILON&&e.x<=n+a+EPSILON,n=e.y>=o-a-EPSILON&&e.y<=i+a+EPSILON;return"x"===r?t:("y"===r||t)&&n}function getElementCenterPoint(e,t){var{centerX:e,centerY:t}=e.getProps(["centerX","centerY"],t);return{x:e,y:t}}function requireVersion(e,t,o,n=!0){var i=o.split(".");let r=0;for(const s of t.split(".")){var a=i[r++];if(parseInt(s,10)<parseInt(a,10))break;if(isOlderPart(a,s)){if(n)throw new Error(e+` v${o} is not supported. v${t} or newer is required.`);return!1}}return!0}const isPercentString=e=>"string"==typeof e&&e.endsWith("%"),toPercent=e=>parseFloat(e)/100,toPositivePercent=e=>clamp(toPercent(e),0,1),boxAppering=(e,t)=>({x:e,y:t,x2:e,y2:t,width:0,height:0}),defaultInitAnimation={box:e=>boxAppering(e.centerX,e.centerY),ellipse:e=>({centerX:e.centerX,centerY:e.centerX,radius:0,width:0,height:0}),label:e=>boxAppering(e.centerX,e.centerY),line:e=>boxAppering(e.x,e.y),point:e=>({centerX:e.centerX,centerY:e.centerY,radius:0,width:0,height:0}),polygon:e=>boxAppering(e.centerX,e.centerY)};function getRelativePosition(e,t){return"start"===t?0:"end"===t?e:isPercentString(t)?toPositivePercent(t)*e:e/2}function getSize(e,t,o=!0){return"number"==typeof t?t:isPercentString(t)?(o?toPositivePercent:toPercent)(t)*e:e}function calculateTextAlignment(e,t){var{x:e,width:o}=e,t=t.textAlign;return"center"===t?e+o/2:"end"===t||"right"===t?e+o:e}function toPosition(e,t="center"){return isObject(e)?{x:valueOrDefault(e.x,t),y:valueOrDefault(e.y,t)}:{x:e=valueOrDefault(e,t),y:e}}function isBoundToPoint(e){return e&&(defined(e.xValue)||defined(e.yValue))}function initAnimationProperties(e,t,o){var n=o.init;if(n)return!0===n?applyDefault(t,o):execCallback(e,t,o)}function loadHooks(t,e,o){let n=!1;return e.forEach(e=>{isFunction(t[e])?(n=!0,o[e]=t[e]):defined(o[e])&&delete o[e]}),n}function applyDefault(e,t){t=t.type||"line";return defaultInitAnimation[t](e)}function execCallback(e,t,o){e=callback(o.init,[{chart:e,properties:t,options:o}]);return!0===e?applyDefault(t,o):isObject(e)?e:void 0}const widthCache=new Map,notRadius=e=>isNaN(e)||e<=0,fontsKey=e=>e.reduce(function(e,t){return e+=t.string},"");function isImageOrCanvas(e){if(e&&"object"==typeof e)return"[object HTMLImageElement]"===(e=e.toString())||"[object HTMLCanvasElement]"===e}function translate(e,{x:t,y:o},n){n&&(e.translate(t,o),e.rotate(toRadians(n)),e.translate(-t,-o))}function setBorderStyle(e,t){if(t&&t.borderWidth)return e.lineCap=t.borderCapStyle,e.setLineDash(t.borderDash),e.lineDashOffset=t.borderDashOffset,e.lineJoin=t.borderJoinStyle,e.lineWidth=t.borderWidth,e.strokeStyle=t.borderColor,!0}function setShadowStyle(e,t){e.shadowColor=t.backgroundShadowColor,e.shadowBlur=t.shadowBlur,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY}function measureLabelSize(e,t){var o=t.content;if(isImageOrCanvas(o))return{width:getSize(o.width,t.width),height:getSize(o.height,t.height)};const n=t.font;var i=isArray(n)?n.map(e=>toFont(e)):[toFont(n)],t=t.textStrokeWidth;const r=isArray(o)?o:[o];o=r.join()+fontsKey(i)+t+(e._measureText?"-spriting":"");return widthCache.has(o)||widthCache.set(o,calculateLabelSize(e,r,i,t)),widthCache.get(o)}function drawBox(e,t,o){var{x:t,y:n,width:i,height:r}=t,a=(e.save(),setShadowStyle(e,o),setBorderStyle(e,o));e.fillStyle=o.backgroundColor,e.beginPath(),addRoundedRectPath(e,{x:t,y:n,w:i,h:r,radius:clampAll(toTRBLCorners(o.borderRadius),0,Math.min(i,r)/2)}),e.closePath(),e.fill(),a&&(e.shadowColor=o.borderShadowColor,e.stroke()),e.restore()}function drawLabel(e,t,o){var n=o.content;if(isImageOrCanvas(n))return e.save(),e.globalAlpha=getOpacity(o.opacity,n.style.opacity),e.drawImage(n,t.x,t.y,t.width,t.height),void e.restore();n=isArray(n)?n:[n];const i=o.font;var r=isArray(i)?i.map(e=>toFont(e)):[toFont(i)],a=o.color,a=isArray(a)?a:[a],s=calculateTextAlignment(t,o),t=t.y+o.textStrokeWidth/2;e.save(),e.textBaseline="middle",e.textAlign=o.textAlign,setTextStrokeStyle(e,o)&&applyLabelDecoration(e,{x:s,y:t},n,r),applyLabelContent(e,{x:s,y:t},n,{fonts:r,colors:a}),e.restore()}function setTextStrokeStyle(e,t){if(0<t.textStrokeWidth)return e.lineJoin="round",e.miterLimit=2,e.lineWidth=t.textStrokeWidth,e.strokeStyle=t.textStrokeColor,!0}function drawPoint(e,t,o,n){var{radius:t,options:i}=t,r=i.pointStyle,i=i.rotation,a=(i||0)*RAD_PER_DEG;if(isImageOrCanvas(r))return e.save(),e.translate(o,n),e.rotate(a),e.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),void e.restore();notRadius(t)||drawPointStyle(e,{x:o,y:n,radius:t,rotation:i,style:r,rad:a})}function drawPointStyle(e,{x:t,y:o,radius:n,rotation:i,style:r,rad:a}){let s,l,d,c;switch(e.beginPath(),r){default:e.arc(t,o,n,0,TAU),e.closePath();break;case"triangle":e.moveTo(t+Math.sin(a)*n,o-Math.cos(a)*n),a+=TWO_THIRDS_PI,e.lineTo(t+Math.sin(a)*n,o-Math.cos(a)*n),a+=TWO_THIRDS_PI,e.lineTo(t+Math.sin(a)*n,o-Math.cos(a)*n),e.closePath();break;case"rectRounded":c=.516*n,d=n-c,s=Math.cos(a+QUARTER_PI)*d,l=Math.sin(a+QUARTER_PI)*d,e.arc(t-s,o-l,c,a-PI,a-HALF_PI),e.arc(t+l,o-s,c,a-HALF_PI,a),e.arc(t+s,o+l,c,a,a+HALF_PI),e.arc(t-l,o+s,c,a+HALF_PI,a+PI),e.closePath();break;case"rect":if(!i){d=Math.SQRT1_2*n,e.rect(t-d,o-d,2*d,2*d);break}a+=QUARTER_PI;case"rectRot":s=Math.cos(a)*n,l=Math.sin(a)*n,e.moveTo(t-s,o-l),e.lineTo(t+l,o-s),e.lineTo(t+s,o+l),e.lineTo(t-l,o+s),e.closePath();break;case"crossRot":a+=QUARTER_PI;case"cross":s=Math.cos(a)*n,l=Math.sin(a)*n,e.moveTo(t-s,o-l),e.lineTo(t+s,o+l),e.moveTo(t+l,o-s),e.lineTo(t-l,o+s);break;case"star":s=Math.cos(a)*n,l=Math.sin(a)*n,e.moveTo(t-s,o-l),e.lineTo(t+s,o+l),e.moveTo(t+l,o-s),e.lineTo(t-l,o+s),a+=QUARTER_PI,s=Math.cos(a)*n,l=Math.sin(a)*n,e.moveTo(t-s,o-l),e.lineTo(t+s,o+l),e.moveTo(t+l,o-s),e.lineTo(t-l,o+s);break;case"line":s=Math.cos(a)*n,l=Math.sin(a)*n,e.moveTo(t-s,o-l),e.lineTo(t+s,o+l);break;case"dash":e.moveTo(t,o),e.lineTo(t+Math.cos(a)*n,o+Math.sin(a)*n)}e.fill()}function calculateLabelSize(t,o,n,i){t.save();var r=o.length;let a=0,s=i;for(let e=0;e<r;e++){var l=n[Math.min(e,n.length-1)],d=(t.font=l.string,o[e]);a=Math.max(a,t.measureText(d).width+i),s+=l.lineHeight}return t.restore(),{width:a,height:s}}function applyLabelDecoration(n,{x:i,y:r},e,a){n.beginPath();let s=0;e.forEach(function(e,t){var t=a[Math.min(t,a.length-1)],o=t.lineHeight;n.font=t.string,n.strokeText(e,i,r+o/2+s),s+=o}),n.stroke()}function applyLabelContent(i,{x:r,y:a},e,{fonts:s,colors:l}){let d=0;e.forEach(function(e,t){var o=l[Math.min(t,l.length-1)],t=s[Math.min(t,s.length-1)],n=t.lineHeight;i.beginPath(),i.font=t.string,i.fillStyle=o,i.fillText(e,r,a+n/2+d),d+=n,i.fill()})}function getOpacity(e,t){e=isNumber(e)?e:t;return isNumber(e)?clamp(e,0,1):1}const limitedLineScale={xScaleID:{min:"xMin",max:"xMax",start:"left",end:"right",startProp:"x",endProp:"x2"},yScaleID:{min:"yMin",max:"yMax",start:"bottom",end:"top",startProp:"y",endProp:"y2"}};function scaleValue(e,t,o){return t="number"==typeof t?t:e.parse(t),isFinite(t)?e.getPixelForValue(t):o}function retrieveScaleID(e,t,o){t=t[o];if(t||"scaleID"===o)return t;const n=o.charAt(0);t=Object.values(e).filter(e=>e.axis&&e.axis===n);return t.length?t[0].id:n}function getDimensionByScale(e,t){var o;if(e)return o=e.options.reverse,{start:scaleValue(e,t.min,o?t.end:t.start),end:scaleValue(e,t.max,o?t.start:t.end)}}function getChartPoint(e,t){var{chartArea:e,scales:o}=e,n=o[retrieveScaleID(o,t,"xScaleID")],o=o[retrieveScaleID(o,t,"yScaleID")];let i=e.width/2,r=e.height/2;return n&&(i=scaleValue(n,t.xValue,n.left+n.width/2)),o&&(r=scaleValue(o,t.yValue,o.top+o.height/2)),{x:i,y:r}}function resolveBoxProperties(e,t){var o=e.scales,n=o[retrieveScaleID(o,t,"xScaleID")],o=o[retrieveScaleID(o,t,"yScaleID")];if(!n&&!o)return{};var{left:i,right:r}=n||e.chartArea,{top:e,bottom:a}=o||e.chartArea,n=getChartDimensionByScale(n,{min:t.xMin,max:t.xMax,start:i,end:r}),i=n.start,r=n.end,n=getChartDimensionByScale(o,{min:t.yMin,max:t.yMax,start:a,end:e});return{x:i,y:e=n.start,x2:r,y2:a=n.end,width:r-i,height:a-e,centerX:i+(r-i)/2,centerY:e+(a-e)/2}}function resolvePointProperties(t,o){if(isBoundToPoint(o))return getChartCircle(t,o);{t=resolveBoxProperties(t,o);let e=o.radius;e&&!isNaN(e)||(e=Math.min(t.width,t.height)/2,o.radius=e);var n=2*e,i=t.centerX+o.xAdjust,t=t.centerY+o.yAdjust;return{x:i-e,y:t-e,x2:i+e,y2:t+e,centerX:i,centerY:t,width:n,height:n,radius:e}}}function resolveLineProperties(e,t){var{scales:e,chartArea:o}=e,n=e[t.scaleID],o={x:o.left,y:o.top,x2:o.right,y2:o.bottom};return n?resolveFullLineProperties(n,o,t):resolveLimitedLineProperties(e,o,t),o}function resolveBoxAndLabelProperties(e,t){const o=resolveBoxProperties(e,t);return o.initProperties=initAnimationProperties(e,o,t),o.elements=[{type:"label",optionScope:"label",properties:resolveLabelElementProperties$1(e,o,t),initProperties:o.initProperties}],o}function getChartCircle(e,t){var e=getChartPoint(e,t),o=2*t.radius;return{x:e.x-t.radius+t.xAdjust,y:e.y-t.radius+t.yAdjust,x2:e.x+t.radius+t.xAdjust,y2:e.y+t.radius+t.yAdjust,centerX:e.x+t.xAdjust,centerY:e.y+t.yAdjust,radius:t.radius,width:o,height:o}}function getChartDimensionByScale(e,t){e=getDimensionByScale(e,t)||t;return{start:Math.min(e.start,e.end),end:Math.max(e.start,e.end)}}function resolveFullLineProperties(e,t,o){var n=scaleValue(e,o.value,NaN),o=scaleValue(e,o.endValue,n);e.isHorizontal()?(t.x=n,t.x2=o):(t.y=n,t.y2=o)}function resolveLimitedLineProperties(e,t,o){for(const c of Object.keys(limitedLineScale)){var n,i,r,a,s,l,d=e[retrieveScaleID(e,o,c)];d&&({min:l,max:n,start:i,end:r,startProp:a,endProp:s}=limitedLineScale[c],l=getDimensionByScale(d,{min:o[l],max:o[n],start:d[i],end:d[r]}),t[a]=l.start,t[s]=l.end)}}function calculateX({properties:e,options:t},o,n,i){var{x:e,x2:r,width:a}=e;return calculatePosition$1({start:e,end:r,size:a,borderWidth:t.borderWidth},{position:n.x,padding:{start:i.left,end:i.right},adjust:t.label.xAdjust,size:o.width})}function calculateY({properties:e,options:t},o,n,i){var{y:e,y2:r,height:a}=e;return calculatePosition$1({start:e,end:r,size:a,borderWidth:t.borderWidth},{position:n.y,padding:{start:i.top,end:i.bottom},adjust:t.label.yAdjust,size:o.height})}function calculatePosition$1(e,t){var{start:e,end:o,borderWidth:n}=e,{position:i,padding:{start:r,end:a},adjust:s}=t;return e+n/2+s+getRelativePosition(o-n-e-r-a-t.size,i)}function resolveLabelElementProperties$1(e,t,o){const n=o.label;n.backgroundColor="transparent",n.callout.display=!1;var i=toPosition(n.position),r=toPadding(n.padding),e=measureLabelSize(e.ctx,n),a=calculateX({properties:t,options:o},e,i,r),t=calculateY({properties:t,options:o},e,i,r),o=e.width+r.width,i=e.height+r.height;return{x:a,y:t,x2:a+o,y2:t+i,width:o,height:i,centerX:a+o/2,centerY:t+i/2,rotation:n.rotation}}function rotated(e,t,o){var n=Math.cos(o),o=Math.sin(o),i=t.x,t=t.y;return{x:i+n*(e.x-i)-o*(e.y-t),y:t+o*(e.x-i)+n*(e.y-t)}}const moveHooks=["enter","leave"],eventHooks=moveHooks.concat("click");function updateListeners(e,o,t){o.listened=loadHooks(t,eventHooks,o.listeners),o.moveListened=!1,o._getElements=getElements,moveHooks.forEach(e=>{isFunction(t[e])&&(o.moveListened=!0)}),o.listened&&o.moveListened||o.annotations.forEach(t=>{!o.listened&&isFunction(t.click)&&(o.listened=!0),o.moveListened||moveHooks.forEach(e=>{isFunction(t[e])&&(o.listened=!0,o.moveListened=!0)})})}function handleEvent(e,t,o){if(e.listened)switch(t.type){case"mousemove":case"mouseout":return handleMoveEvents(e,t,o);case"click":return handleClickEvents(e,t,o)}}function handleMoveEvents(t,o,n){if(t.moveListened){let e;e="mousemove"===o.type?getElements(t,o,n.interaction):[];n=t.hovered,t=(t.hovered=e,{state:t,event:o}),o=dispatchMoveEvents(t,"leave",n,e);return dispatchMoveEvents(t,"enter",e,n)||o}}function dispatchMoveEvents({state:e,event:t},o,n,i){let r;for(const a of n)i.indexOf(a)<0&&(r=dispatchEvent(a.options[o]||e.listeners[o],a,t)||r);return r}function handleClickEvents(e,t,o){var n=e.listeners;let i;for(const r of getElements(e,t,o.interaction))i=dispatchEvent(r.options.click||n.click,r,t)||i;return i}function dispatchEvent(e,t,o){return!0===callback(e,[t.$context,o])}const elementHooks=["afterDraw","beforeDraw"];function updateHooks(e,o,t){const n=o.visibleElements;o.hooked=loadHooks(t,elementHooks,o.hooks),o.hooked||n.forEach(t=>{o.hooked||elementHooks.forEach(e=>{isFunction(t.options[e])&&(o.hooked=!0)})})}function invokeHook(e,t,o){if(e.hooked)return e=t.options[o]||e.hooks[o],callback(e,[t.$context])}function adjustScaleRange(e,t,o){e=getScaleLimits(e.scales,t,o);let n=changeScaleLimit(t,e,"min","suggestedMin");(n=changeScaleLimit(t,e,"max","suggestedMax")||n)&&isFunction(t.handleTickRangeOptions)&&t.handleTickRangeOptions()}function verifyScaleOptions(e,t){for(const o of e)verifyScaleIDs(o,t)}function changeScaleLimit(e,t,o,n){if(isFinite(t[o])&&!scaleLimitDefined(e.options,o,n))return n=e[o]!==t[o],e[o]=t[o],n}function scaleLimitDefined(e,t,o){return defined(e[t])||defined(e[o])}function verifyScaleIDs(e,t){for(const n of["scaleID","xScaleID","yScaleID"]){var o=retrieveScaleID(t,e,n);o&&!t[o]&&verifyProperties(e,n)&&console.warn(`No scale found with id '${o}' for annotation '${e.id}'`)}}function verifyProperties(e,t){if("scaleID"===t)return!0;var o=t.charAt(0);for(const n of["Min","Max","Value"])if(defined(e[o+n]))return!0;return!1}function getScaleLimits(e,t,o){var n=t.axis,i=t.id,r=n+"ScaleID",a={min:valueOrDefault(t.min,Number.NEGATIVE_INFINITY),max:valueOrDefault(t.max,Number.POSITIVE_INFINITY)};for(const s of o)s.scaleID===i?updateLimits(s,t,["value","endValue"],a):retrieveScaleID(e,s,r)===i&&updateLimits(s,t,[n+"Min",n+"Max",n+"Value"],a);return a}function updateLimits(e,t,o,n){for(const r of o){var i=e[r];defined(i)&&(i=t.parse(i),n.min=Math.min(n.min,i),n.max=Math.max(n.max,i))}}class BoxAnnotation extends Element{inRange(e,t,o,n){var{x:e,y:t}=rotated({x:e,y:t},this.getCenterPoint(n),toRadians(-this.options.rotation));return inBoxRange({x:e,y:t},this.getProps(["x","y","x2","y2"],n),o,this.options.borderWidth)}getCenterPoint(e){return getElementCenterPoint(this,e)}draw(e){e.save(),translate(e,this.getCenterPoint(),this.options.rotation),drawBox(e,this,this.options),e.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(e,t){return resolveBoxAndLabelProperties(e,t)}}BoxAnnotation.id="boxAnnotation",BoxAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,label:{backgroundColor:"transparent",borderWidth:0,callout:{display:!1},color:"black",content:null,display:!1,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,opacity:void 0,padding:6,position:"center",rotation:void 0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0,z:void 0},rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0},BoxAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"},BoxAnnotation.descriptors={label:{_fallback:!0}};const positions=["left","bottom","top","right"];class LabelAnnotation extends Element{inRange(e,t,o,n){var{x:e,y:t}=rotated({x:e,y:t},this.getCenterPoint(n),toRadians(-this.rotation));return inBoxRange({x:e,y:t},this.getProps(["x","y","x2","y2"],n),o,this.options.borderWidth)}getCenterPoint(e){return getElementCenterPoint(this,e)}draw(e){var t=this.options,o=!defined(this._visible)||this._visible;t.display&&t.content&&o&&(e.save(),translate(e,this.getCenterPoint(),this.rotation),drawCallout(e,this),drawBox(e,this,t),drawLabel(e,getLabelSize(this),t),e.restore())}resolveElementProperties(e,t){let o;o=isBoundToPoint(t)?getChartPoint(e,t):({centerX:n,centerY:i}=resolveBoxProperties(e,t),{x:n,y:i});var n=toPadding(t.padding),i=measureLabelSize(e.ctx,t),i=measureRect(o,i,t,n);return{initProperties:initAnimationProperties(e,i,t),pointX:o.x,pointY:o.y,...i,rotation:t.rotation}}}function measureRect(e,t,o,n){var i=t.width+n.width+o.borderWidth,t=t.height+n.height+o.borderWidth,n=toPosition(o.position,"center"),r=calculatePosition(e.x,i,o.xAdjust,n.x),e=calculatePosition(e.y,t,o.yAdjust,n.y);return{x:r,y:e,x2:r+i,y2:e+t,width:i,height:t,centerX:r+i/2,centerY:e+t/2}}function calculatePosition(e,t,o=0,n){return e-getRelativePosition(t,n)+o}function drawCallout(e,t){var{pointX:o,pointY:n,options:i}=t,r=i.callout,a=r&&r.display&&resolveCalloutPosition(t,r);if(a&&!isPointInRange(t,r,a)){if(e.save(),e.beginPath(),!setBorderStyle(e,r))return e.restore();var{separatorStart:s,separatorEnd:l}=getCalloutSeparatorCoord(t,a),{sideStart:a,sideEnd:d}=getCalloutSideCoord(t,a,s),r=((0<r.margin||0===i.borderWidth)&&(e.moveTo(s.x,s.y),e.lineTo(l.x,l.y)),e.moveTo(a.x,a.y),e.lineTo(d.x,d.y),rotated({x:o,y:n},t.getCenterPoint(),toRadians(-t.rotation)));e.lineTo(r.x,r.y),e.stroke(),e.restore()}}function getCalloutSeparatorCoord(e,t){var{x:o,y:n,x2:i,y2:r}=e,e=getCalloutSeparatorAdjust(e,t);let a,s;return s="left"===t||"right"===t?{x:(a={x:o+e,y:n}).x,y:r}:{x:i,y:(a={x:o,y:n+e}).y},{separatorStart:a,separatorEnd:s}}function getCalloutSeparatorAdjust(e,t){var{width:e,height:o,options:n}=e,n=n.callout.margin+n.borderWidth/2;return"right"===t?e+n:"bottom"===t?o+n:-n}function getCalloutSideCoord(e,t,o){var{y:e,width:n,height:i,options:r}=e,a=r.callout.start,r=getCalloutSideAdjust(t,r.callout);let s,l;return l="left"===t||"right"===t?{x:(s={x:o.x,y:e+getSize(i,a)}).x+r,y:s.y}:{x:(s={x:o.x+getSize(n,a),y:o.y}).x,y:s.y+r},{sideStart:s,sideEnd:l}}function getCalloutSideAdjust(e,t){t=t.side;return"left"===e||"top"===e?-t:t}function resolveCalloutPosition(e,t){var o=t.position;return positions.includes(o)?o:resolveCalloutAutoPosition(e,t)}function resolveCalloutAutoPosition(e,t){var{x:e,y:o,x2:n,y2:i,width:r,height:a,pointX:s,pointY:l,centerX:d,centerY:c,rotation:u}=e,h={x:d,y:c},d=t.start,c=getSize(r,d),p=[e,e+c,e+c,n],y=[o+getSize(a,d),i,o,i];const f=[];for(let e=0;e<4;e++){var x=rotated({x:p[e],y:y[e]},h,toRadians(u));f.push({position:positions[e],distance:distanceBetweenPoints(x,{x:s,y:l})})}return f.sort((e,t)=>e.distance-t.distance)[0].position}function getLabelSize({x:e,y:t,width:o,height:n,options:i}){var r=i.borderWidth/2,a=toPadding(i.padding);return{x:e+a.left+r,y:t+a.top+r,width:o-a.left-a.right-i.borderWidth,height:n-a.top-a.bottom-i.borderWidth}}function isPointInRange(e,t,o){var{pointX:n,pointY:i}=e,t=t.margin;let r=n,a=i;return"left"===o?r+=t:"right"===o?r-=t:"top"===o?a+=t:"bottom"===o&&(a-=t),e.inRange(r,a)}LabelAnnotation.id="labelAnnotation",LabelAnnotation.defaults={adjustScaleRange:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:0,callout:{borderCapStyle:"butt",borderColor:void 0,borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:1,display:!1,margin:5,position:"auto",side:5,start:"50%"},color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,init:void 0,opacity:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0},LabelAnnotation.defaultRoutes={borderColor:"color"};const pointInLine=(e,t,o)=>({x:e.x+o*(t.x-e.x),y:e.y+o*(t.y-e.y)}),interpolateX=(e,t,o)=>pointInLine(t,o,Math.abs((e-t.y)/(o.y-t.y))).x,interpolateY=(e,t,o)=>pointInLine(t,o,Math.abs((e-t.x)/(o.x-t.x))).y,sqr=e=>e*e,rangeLimit=(e,t,{x:o,y:n,x2:i,y2:r},a)=>"y"===a?{start:Math.min(n,r),end:Math.max(n,r),value:t}:{start:Math.min(o,i),end:Math.max(o,i),value:e},coordInCurve=(e,t,o,n)=>(1-n)*(1-n)*e+2*(1-n)*n*t+n*n*o,pointInCurve=(e,t,o,n)=>({x:coordInCurve(e.x,t.x,o.x,n),y:coordInCurve(e.y,t.y,o.y,n)}),coordAngleInCurve=(e,t,o,n)=>2*(1-n)*(t-e)+2*n*(o-t),angleInCurve=(e,t,o,n)=>-Math.atan2(coordAngleInCurve(e.x,t.x,o.x,n),coordAngleInCurve(e.y,t.y,o.y,n))+.5*PI;class LineAnnotation extends Element{inRange(e,t,o,n){var i=this.options.borderWidth/2;if("x"===o||"y"===o)return inAxisRange(this,{mouseX:e,mouseY:t},o,{hBorderWidth:i,useFinalPosition:n});{var r,o={mouseX:e,mouseY:t};const{path:a,ctx:s}=this;return a?(setBorderStyle(s,this.options),r=this.$context["chart"],e=e*r.currentDevicePixelRatio,t=t*r.currentDevicePixelRatio,r=s.isPointInStroke(a,e,t)||isOnLabel(this,o,n),s.restore(),r):intersects(this,o,sqr(i),n)||isOnLabel(this,o,n)}}getCenterPoint(e){return getElementCenterPoint(this,e)}draw(e){var{x:t,y:o,x2:n,y2:i,cp:r,options:a}=this;if(e.save(),!setBorderStyle(e,a))return e.restore();setShadowStyle(e,a);var s=Math.sqrt(Math.pow(n-t,2)+Math.pow(i-o,2));if(a.curve&&r)return drawCurve(e,this,r,s),e.restore();var{startOpts:r,endOpts:l,startAdjust:d,endAdjust:c}=getArrowHeads(this),i=Math.atan2(i-o,n-t);e.translate(t,o),e.rotate(i),e.beginPath(),e.moveTo(0+d,0),e.lineTo(s-c,0),e.shadowColor=a.borderShadowColor,e.stroke(),drawArrowHead(e,0,d,r),drawArrowHead(e,s,-c,l),e.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(e,t){var o=resolveLineProperties(e,t),{x:n,y:i,x2:r,y2:a}=o,o=isLineInArea(o,e.chartArea);const s=o?limitLineToArea({x:n,y:i},{x:r,y:a},e.chartArea):{x:n,y:i,x2:r,y2:a,width:Math.abs(r-n),height:Math.abs(a-i)},l=(s.centerX=(r+n)/2,s.centerY=(a+i)/2,s.initProperties=initAnimationProperties(e,s,t),t.curve&&(r={x:s.x,y:s.y},n={x:s.x2,y:s.y2},s.cp=getControlPoint(s,t,distanceBetweenPoints(r,n))),resolveLabelElementProperties(e,s,t.label));return l._visible=o,s.elements=[{type:"label",optionScope:"label",properties:l,initProperties:s.initProperties}],s}}LineAnnotation.id="lineAnnotation";const arrowHeadsDefaults={backgroundColor:void 0,backgroundShadowColor:void 0,borderColor:void 0,borderDash:void 0,borderDashOffset:void 0,borderShadowColor:void 0,borderWidth:void 0,display:void 0,fill:void 0,length:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,width:void 0};function inAxisRange(e,{mouseX:t,mouseY:o},n,{hBorderWidth:i,useFinalPosition:r}){var a=rangeLimit(t,o,e.getProps(["x","y","x2","y2"],r),n);return a.value>=a.start-i&&a.value<=a.end+i||isOnLabel(e,{mouseX:t,mouseY:o},r,n)}function isLineInArea({x:e,y:t,x2:o,y2:n},{top:i,right:r,bottom:a,left:s}){return!(e<s&&o<s||r<e&&r<o||t<i&&n<i||a<t&&a<n)}function limitPointToArea({x:e,y:t},o,{top:n,right:i,bottom:r,left:a}){return e<a&&(t=interpolateY(a,{x:e,y:t},o),e=a),i<e&&(t=interpolateY(i,{x:e,y:t},o),e=i),t<n&&(e=interpolateX(n,{x:e,y:t},o),t=n),r<t&&(e=interpolateX(r,{x:e,y:t},o),t=r),{x:e,y:t}}function limitLineToArea(e,t,o){var{x:n,y:i}=limitPointToArea(e,t,o),{x:t,y:e}=limitPointToArea(t,e,o);return{x:n,y:i,x2:t,y2:e,width:Math.abs(t-n),height:Math.abs(e-i)}}function intersects(e,{mouseX:t,mouseY:o},n=EPSILON,i){var{x:e,y:i,x2:r,y2:a}=e.getProps(["x","y","x2","y2"],i),s=r-e,l=a-i,d=sqr(s)+sqr(l),d=0===d?-1:((t-e)*s+(o-i)*l)/d;let c,u;return u=d<0?(c=e,i):1<d?(c=r,a):(c=e+d*s,i+d*l),sqr(t-c)+sqr(o-u)<=n}function isOnLabel(e,{mouseX:t,mouseY:o},n,i){const r=e.label;return r.options.display&&r.inRange(t,o,i,n)}function resolveLabelElementProperties(e,t,o){var n=o.borderWidth,i=toPadding(o.padding),r=measureLabelSize(e.ctx,o);return calculateLabelPosition(t,o,{width:r.width+i.width+n,height:r.height+i.height+n,padding:i},e.chartArea)}function calculateAutoRotation(e){var{x:e,y:t,x2:o,y2:n}=e,n=Math.atan2(n-t,o-e);return PI/2<n?n-PI:n<PI/-2?n+PI:n}function calculateLabelPosition(e,t,o,n){var{width:o,height:i,padding:r}=o,{xAdjust:a,yAdjust:s}=t,l={x:e.x,y:e.y},d={x:e.x2,y:e.y2},c="auto"===t.rotation?calculateAutoRotation(e):toRadians(t.rotation),u=rotatedSize(o,i,c),t=calculateT(e,t,{labelSize:u,padding:r},n),e=e.cp?pointInCurve(l,e.cp,d,t):pointInLine(l,d,t),l={size:u.w,min:n.left,max:n.right,padding:r.left},d={size:u.h,min:n.top,max:n.bottom,padding:r.top},t=adjustLabelCoordinate(e.x,l)+a,u=adjustLabelCoordinate(e.y,d)+s;return{x:t-o/2,y:u-i/2,x2:t+o/2,y2:u+i/2,centerX:t,centerY:u,pointX:e.x,pointY:e.y,width:o,height:i,rotation:toDegrees(c)}}function rotatedSize(e,t,o){var n=Math.cos(o),o=Math.sin(o);return{w:Math.abs(e*n)+Math.abs(t*o),h:Math.abs(e*o)+Math.abs(t*n)}}function calculateT(e,t,o,n){let i;n=spaceAround(e,n);return i="start"===t.position?calculateTAdjust({w:e.x2-e.x,h:e.y2-e.y},o,t,n):"end"===t.position?1-calculateTAdjust({w:e.x-e.x2,h:e.y-e.y2},o,t,n):getRelativePosition(1,t.position)}function calculateTAdjust(e,t,o,n){var{labelSize:t,padding:i}=t,r=e.w*n.dx,e=e.h*n.dy,r=0<r&&(t.w/2+i.left-n.x)/r,t=0<e&&(t.h/2+i.top-n.y)/e;return clamp(Math.max(r,t),0,.25)}function spaceAround(e,t){var{x:e,x2:o,y:n,y2:i}=e,r=Math.min(n,i)-t.top,a=Math.min(e,o)-t.left,n=t.bottom-Math.max(n,i),i=t.right-Math.max(e,o);return{x:Math.min(a,i),y:Math.min(r,n),dx:a<=i?1:-1,dy:r<=n?1:-1}}function adjustLabelCoordinate(e,t){var{size:t,min:o,max:n,padding:i}=t,r=t/2;return n-o<t?(n+o)/2:n<=(e=e-i-r<=o?o+i+r:e)+i+r?n-i-r:e}function getArrowHeads(e){var t=e.options,o=t.arrowHeads&&t.arrowHeads.start,t=t.arrowHeads&&t.arrowHeads.end;return{startOpts:o,endOpts:t,startAdjust:getLineAdjust(e,o),endAdjust:getLineAdjust(e,t)}}function getLineAdjust(e,t){if(!t||!t.display)return 0;var{length:t,width:o}=t,e=e.options.borderWidth/2,t={x:t,y:o+e},o={x:0,y:e};return Math.abs(interpolateX(0,t,o))}function drawArrowHead(e,t,o,n){var i,r,a,s,l;n&&n.display&&({length:l,width:i,fill:r,backgroundColor:a,borderColor:s}=n,l=Math.abs(t-l)+o,e.beginPath(),setShadowStyle(e,n),setBorderStyle(e,n),e.moveTo(l,-i),e.lineTo(t+o,0),e.lineTo(l,i),!0===r?(e.fillStyle=a||s,e.closePath(),e.fill(),e.shadowColor="transparent"):e.shadowColor=n.borderShadowColor,e.stroke())}function getControlPoint(e,t,o){var{x:e,y:n,x2:i,y2:r,centerX:a,centerY:s}=e,r=Math.atan2(r-n,i-e),n=toPosition(t.controlPoint,0);return rotated({x:a+getSize(o,n.x,!1),y:s+getSize(o,n.y,!1)},{x:a,y:s},r)}function drawArrowHeadOnCurve(e,{x:t,y:o},{angle:n,adjust:i},r){r&&r.display&&(e.save(),e.translate(t,o),e.rotate(n),drawArrowHead(e,0,-i,r),e.restore())}function drawCurve(e,t,o,n){var{x:i,y:r,x2:a,y2:s,options:l}=t,{startOpts:d,endOpts:c,startAdjust:u,endAdjust:h}=getArrowHeads(t),i={x:i,y:r},r={x:a,y:s},a=angleInCurve(i,o,r,0),s=angleInCurve(i,o,r,1)-PI,p=pointInCurve(i,o,r,u/n),i=pointInCurve(i,o,r,1-h/n);const y=new Path2D;e.beginPath(),y.moveTo(p.x,p.y),y.quadraticCurveTo(o.x,o.y,i.x,i.y),e.shadowColor=l.borderShadowColor,e.stroke(y),t.path=y,drawArrowHeadOnCurve(t.ctx=e,p,{angle:a,adjust:u},d),drawArrowHeadOnCurve(e,i,{angle:s,adjust:h},c)}LineAnnotation.defaults={adjustScaleRange:!0,arrowHeads:{display:!1,end:Object.assign({},arrowHeadsDefaults),fill:!1,length:12,start:Object.assign({},arrowHeadsDefaults),width:6},borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:2,curve:!1,controlPoint:{y:"-50%"},display:!0,endValue:void 0,init:void 0,label:{backgroundColor:"rgba(0,0,0,0.8)",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderShadowColor:"transparent",borderWidth:0,callout:Object.assign({},LabelAnnotation.defaults.callout),color:"#fff",content:null,display:!1,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,opacity:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0,z:void 0},scaleID:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,value:void 0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0},LineAnnotation.descriptors={arrowHeads:{start:{_fallback:!0},end:{_fallback:!0},_fallback:!0}},LineAnnotation.defaultRoutes={borderColor:"color"};class EllipseAnnotation extends Element{inRange(e,t,o,n){var i=this.options.rotation,r=this.options.borderWidth;if("x"!==o&&"y"!==o)return pointInEllipse({x:e,y:t},this.getProps(["width","height","centerX","centerY"],n),i,r);var{x:a,y:s,x2:l,y2:d}=this.getProps(["x","y","x2","y2"],n),r=r/2,s="y"===o?{start:s,end:d}:{start:a,end:l},d=rotated({x:e,y:t},this.getCenterPoint(n),toRadians(-i));return d[o]>=s.start-r-EPSILON&&d[o]<=s.end+r+EPSILON}getCenterPoint(e){return getElementCenterPoint(this,e)}draw(e){var{width:t,height:o,centerX:n,centerY:i,options:r}=this,a=(e.save(),translate(e,this.getCenterPoint(),r.rotation),setShadowStyle(e,this.options),e.beginPath(),e.fillStyle=r.backgroundColor,setBorderStyle(e,r));e.ellipse(n,i,o/2,t/2,PI/2,0,2*PI),e.fill(),a&&(e.shadowColor=r.borderShadowColor,e.stroke()),e.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(e,t){return resolveBoxAndLabelProperties(e,t)}}function pointInEllipse(e,t,o,n){var{width:t,height:i,centerX:r,centerY:a}=t,t=t/2,i=i/2;if(t<=0||i<=0)return!1;var o=toRadians(o||0),n=n/2||0,s=Math.cos(o),o=Math.sin(o),l=Math.pow(s*(e.x-r)+o*(e.y-a),2),o=Math.pow(o*(e.x-r)-s*(e.y-a),2);return l/Math.pow(t+n,2)+o/Math.pow(i+n,2)<=1.0001}EllipseAnnotation.id="ellipseAnnotation",EllipseAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,label:Object.assign({},BoxAnnotation.defaults.label),rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0},EllipseAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"},EllipseAnnotation.descriptors={label:{_fallback:!0}};class PointAnnotation extends Element{inRange(e,t,o,n){var{x:i,y:r,x2:a,y2:s,width:l}=this.getProps(["x","y","x2","y2","width"],n),d=this.options.borderWidth;if("x"!==o&&"y"!==o)return inPointRange({x:e,y:t},this.getCenterPoint(n),l/2,d);n=d/2,l="y"===o?{start:r,end:s,value:t}:{start:i,end:a,value:e};return l.start-n<=l.value&&l.value<=l.end+n}getCenterPoint(e){return getElementCenterPoint(this,e)}draw(e){const t=this.options;var o,n=t.borderWidth;t.radius<.1||(e.save(),e.fillStyle=t.backgroundColor,setShadowStyle(e,t),o=setBorderStyle(e,t),drawPoint(e,this,this.centerX,this.centerY),o&&!isImageOrCanvas(t.pointStyle)&&(e.shadowColor=t.borderShadowColor,e.stroke()),e.restore(),t.borderWidth=n)}resolveElementProperties(e,t){const o=resolvePointProperties(e,t);return o.initProperties=initAnimationProperties(e,o,t),o}}PointAnnotation.id="pointAnnotation",PointAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,pointStyle:"circle",radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0},PointAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"};class PolygonAnnotation extends Element{inRange(e,t,o,n){if("x"!==o&&"y"!==o)return.1<=this.options.radius&&1<this.elements.length&&pointIsInPolygon(this.elements,e,t,n);e=rotated({x:e,y:t},this.getCenterPoint(n),toRadians(-this.options.rotation)),t=this.elements.map(e=>"y"===o?e.bY:e.bX),n=Math.min(...t),t=Math.max(...t);return e[o]>=n&&e[o]<=t}getCenterPoint(e){return getElementCenterPoint(this,e)}draw(e){var{elements:t,options:o}=this,n=(e.save(),e.beginPath(),e.fillStyle=o.backgroundColor,setShadowStyle(e,o),setBorderStyle(e,o));let i=!0;for(const r of t)i?(e.moveTo(r.x,r.y),i=!1):e.lineTo(r.x,r.y);e.closePath(),e.fill(),n&&(e.shadowColor=o.borderShadowColor,e.stroke()),e.restore()}resolveElementProperties(t,o){const n=resolvePointProperties(t,o);var{sides:i,rotation:e}=o;const r=[];var a=2*PI/i;let s=e*RAD_PER_DEG;for(let e=0;e<i;e++,s+=a){const l=buildPointElement(n,o,s);l.initProperties=initAnimationProperties(t,n,o),r.push(l)}return n.elements=r,n}}function buildPointElement({centerX:e,centerY:t},{radius:o,borderWidth:n},i){var n=n/2,r=Math.sin(i),i=Math.cos(i);const a=e+r*o,s=t-i*o;return{type:"point",optionScope:"point",properties:{x:a,y:s,centerX:a,centerY:s,bX:e+r*(o+n),bY:t-i*(o+n)}}}function pointIsInPolygon(e,t,o,n){let i=!1,r=e[e.length-1].getProps(["bX","bY"],n);for(const s of e){var a=s.getProps(["bX","bY"],n);a.bY>o!=r.bY>o&&t<(r.bX-a.bX)*(o-a.bY)/(r.bY-a.bY)+a.bX&&(i=!i),r=a}return i}PolygonAnnotation.id="polygonAnnotation",PolygonAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,point:{radius:0},radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,sides:3,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0},PolygonAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"};const annotationTypes={box:BoxAnnotation,ellipse:EllipseAnnotation,label:LabelAnnotation,line:LineAnnotation,point:PointAnnotation,polygon:PolygonAnnotation},directUpdater=(Object.keys(annotationTypes).forEach(e=>{defaults.describe("elements."+annotationTypes[e].id,{_fallback:"plugins.annotation.common"})}),{update:Object.assign}),hooks$1=eventHooks.concat(elementHooks),resolve=(e,t)=>isObject(t)?resolveObj(e,t):e,isIndexable=e=>"color"===e||"font"===e;function resolveType(e="line"){return annotationTypes[e]?e:(console.warn(`Unknown annotation type: '${e}', defaulting to 'line'`),"line")}function updateElements(t,e,o,n){const i=resolveAnimations(t,o.animations,n);var r=e.annotations,a=resyncElements(e.elements,r);for(let e=0;e<r.length;e++){const l=r[e],d=getOrCreateElement(a,e,l.type);var s=l.setContext(getContext(t,d,l));const c=d.resolveElementProperties(t,s);c.skip=toSkip(c),"elements"in c&&(updateSubElements(d,c.elements,s,i),delete c.elements),defined(d.x)||Object.assign(d,c),Object.assign(d,c.initProperties),c.options=resolveAnnotationOptions(s),i.update(d,c)}}function toSkip(e){return isNaN(e.x)||isNaN(e.y)}function resolveAnimations(e,t,o){return"reset"===o||"none"===o||"resize"===o?directUpdater:new Animations(e,t)}function updateSubElements(e,t,o,n){const i=e.elements||(e.elements=[]);i.length=t.length;for(let e=0;e<t.length;e++){var r=t[e];const s=r.properties;var a=getOrCreateElement(i,e,r.type,r.initProperties),r=o[r.optionScope].override(r);s.options=resolveAnnotationOptions(r),n.update(a,s)}}function getOrCreateElement(e,t,o,n){const i=annotationTypes[resolveType(o)];let r=e[t];return r&&r instanceof i||(r=e[t]=new i,Object.assign(r,n)),r}function resolveAnnotationOptions(e){var t=annotationTypes[resolveType(e.type)];const o={};o.id=e.id,o.type=e.type,o.drawTime=e.drawTime,Object.assign(o,resolveObj(e,t.defaults),resolveObj(e,t.defaultRoutes));for(const n of hooks$1)o[n]=e[n];return o}function resolveObj(e,t){const o={};for(const n of Object.keys(t)){const i=t[n],r=e[n];isIndexable(n)&&isArray(r)?o[n]=r.map(e=>resolve(e,i)):o[n]=resolve(r,i)}return o}function getContext(e,t,o){return t.$context||(t.$context=Object.assign(Object.create(e.getContext()),{element:t,id:o.id,type:"annotation"}))}function resyncElements(e,t){var t=t.length,o=e.length;return o<t?e.splice(o,0,...new Array(t-o)):t<o&&e.splice(t,o-t),e}var version="3.0.1";const chartStates=new Map,hooks=eventHooks.concat(elementHooks);var annotation={id:"annotation",version:version,beforeRegister(){requireVersion("chart.js","4.0",Chart.version)},afterRegister(){Chart.register(annotationTypes)},afterUnregister(){Chart.unregister(annotationTypes)},beforeInit(e){chartStates.set(e,{annotations:[],elements:[],visibleElements:[],listeners:{},listened:!1,moveListened:!1,hooks:{},hooked:!1,hovered:[]})},beforeUpdate(e,t,o){const n=chartStates.get(e),i=n.annotations=[];let r=o.annotations;isObject(r)?Object.keys(r).forEach(e=>{const t=r[e];isObject(t)&&(t.id=e,i.push(t))}):isArray(r)&&i.push(...r),verifyScaleOptions(i,e.scales)},afterDataLimits(e,t){const o=chartStates.get(e);adjustScaleRange(e,t.scale,o.annotations.filter(e=>e.display&&e.adjustScaleRange))},afterUpdate(e,t,o){const n=chartStates.get(e);updateListeners(e,n,o),updateElements(e,n,o,t.mode),n.visibleElements=n.elements.filter(e=>!e.skip&&e.options.display),updateHooks(e,n,o)},beforeDatasetsDraw(e,t,o){draw(e,"beforeDatasetsDraw",o.clip)},afterDatasetsDraw(e,t,o){draw(e,"afterDatasetsDraw",o.clip)},beforeDraw(e,t,o){draw(e,"beforeDraw",o.clip)},afterDraw(e,t,o){draw(e,"afterDraw",o.clip)},beforeEvent(e,t,o){handleEvent(chartStates.get(e),t.event,o)&&(t.changed=!0)},afterDestroy(e){chartStates.delete(e)},_getState(e){return chartStates.get(e)},defaults:{animations:{numbers:{properties:["x","y","x2","y2","width","height","centerX","centerY","pointX","pointY","radius"],type:"number"}},clip:!0,interaction:{mode:void 0,axis:void 0,intersect:void 0},common:{drawTime:"afterDatasetsDraw",init:!1,label:{}}},descriptors:{_indexable:!1,_scriptable:e=>!hooks.includes(e)&&"init"!==e,annotations:{_allKeys:!1,_fallback:(e,t)=>"elements."+annotationTypes[resolveType(t.type)].id},interaction:{_fallback:!0},common:{label:{_indexable:isIndexable,_fallback:!0},_indexable:isIndexable}},additionalOptionScopes:[""]};function draw(e,t,o){var{ctx:n,chartArea:i}=e,r=chartStates.get(e),e=(o&&clipArea(n,i),getDrawableElements(r.visibleElements,t).sort((e,t)=>e.element.options.z-t.element.options.z));for(const a of e)drawElement(n,i,r,a);o&&unclipArea(n)}function getDrawableElements(e,t){const o=[];for(const n of e)if(n.options.drawTime===t&&o.push({element:n,main:!0}),n.elements&&n.elements.length)for(const i of n.elements)i.options.display&&i.options.drawTime===t&&o.push({element:i});return o}function drawElement(e,t,o,n){const i=n.element;n.main?(invokeHook(o,i,"beforeDraw"),i.draw(e,t),invokeHook(o,i,"afterDraw")):i.draw(e,t)}export{annotation as default};