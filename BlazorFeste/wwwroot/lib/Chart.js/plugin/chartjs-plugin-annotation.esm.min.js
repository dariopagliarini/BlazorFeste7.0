import{Element,defaults,Animations,Chart}from"chart.js";import{distanceBetweenPoints,isObject,valueOrDefault,defined,callback,isFunction,toRadians,isArray,toFont,addRoundedRectPath,toTRBLCorners,QUARTER_PI,PI,HALF_PI,TWO_THIRDS_PI,TAU,isNumber,RAD_PER_DEG,toPadding,isFinite,toDegrees,clipArea,unclipArea}from"chart.js/helpers";const interaction={modes:{point(t,e){return filterElements(t,e,{intersect:!0})},nearest(t,e,o){return getNearestItem(t,e,o)},x(t,e,o){return filterElements(t,e,{intersect:o.intersect,axis:"x"})},y(t,e,o){return filterElements(t,e,{intersect:o.intersect,axis:"y"})}}};function getElements(t,e,o){const n=interaction.modes[o.mode]||interaction.modes.nearest;return n(t,e,o)}function inRangeByAxis(t,e,o){return"x"!==o&&"y"!==o?t.inRange(e.x,e.y,"x",!0)||t.inRange(e.x,e.y,"y",!0):t.inRange(e.x,e.y,o,!0)}function getPointByAxis(t,e,o){return"x"===o?{x:t.x,y:e.y}:"y"===o?{x:e.x,y:t.y}:e}function filterElements(t,e,o){return t.visibleElements.filter(t=>o.intersect?t.inRange(e.x,e.y):inRangeByAxis(t,e,o.axis))}function getNearestItem(t,n,r){let i=Number.POSITIVE_INFINITY;return filterElements(t,n,r).reduce((t,e)=>{var o=e.getCenterPoint(),o=getPointByAxis(n,o,r.axis),o=distanceBetweenPoints(n,o);return o<i?(t=[e],i=o):o===i&&t.push(e),t},[]).sort((t,e)=>t._index-e._index).slice(0,1)}const isOlderPart=(t,e)=>t<e||t.length>e.length&&t.slice(0,e.length)===e,EPSILON=.001,clamp=(t,e,o)=>Math.min(o,Math.max(e,t));function clampAll(t,e,o){for(const n of Object.keys(t))t[n]=clamp(t[n],e,o);return t}function inPointRange(t,e,o,n){if(!t||!e||o<=0)return!1;n/=2;return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(o+n,2)}function inBoxRange(t,{x:e,y:o,x2:n,y2:r},i,a){a/=2,e=t.x>=e-a-EPSILON&&t.x<=n+a+EPSILON,n=t.y>=o-a-EPSILON&&t.y<=r+a+EPSILON;return"x"===i?e:("y"===i||e)&&n}function getElementCenterPoint(t,e){var{centerX:t,centerY:e}=t.getProps(["centerX","centerY"],e);return{x:t,y:e}}function requireVersion(t,e,o,n=!0){var r=o.split(".");let i=0;for(const s of e.split(".")){var a=r[i++];if(parseInt(s,10)<parseInt(a,10))break;if(isOlderPart(a,s)){if(n)throw new Error(t+` v${o} is not supported. v${e} or newer is required.`);return!1}}return!0}const isPercentString=t=>"string"==typeof t&&t.endsWith("%"),toPercent=t=>parseFloat(t)/100,toPositivePercent=t=>clamp(toPercent(t),0,1);function getRelativePosition(t,e){return"start"===e?0:"end"===e?t:isPercentString(e)?toPositivePercent(e)*t:t/2}function getSize(t,e,o=!0){return"number"==typeof e?e:isPercentString(e)?(o?toPositivePercent:toPercent)(e)*t:t}function calculateTextAlignment(t,e){var{x:t,width:o}=t,e=e.textAlign;return"center"===e?t+o/2:"end"===e||"right"===e?t+o:t}function toPosition(t,e="center"){return isObject(t)?{x:valueOrDefault(t.x,e),y:valueOrDefault(t.y,e)}:{x:t=valueOrDefault(t,e),y:t}}function isBoundToPoint(t){return t&&(defined(t.xValue)||defined(t.yValue))}function initAnimationProperties(t,e,o,n=!1){var r=o.init;if(r)return!0===r?applyDefault(e,n):checkCallbackResult(e,n,callback(r,[{chart:t,properties:e,options:o}]))}function loadHooks(e,t,o){let n=!1;return t.forEach(t=>{isFunction(e[t])?(n=!0,o[t]=e[t]):defined(o[t])&&delete o[t]}),n}function applyDefault({centerX:t,centerY:e},o){return o?{centerX:t,centerY:e,radius:0,width:0,height:0}:{x:t,y:e,x2:t,y2:e,width:0,height:0}}function checkCallbackResult(t,e,o){return!0===o?applyDefault(t,e):isObject(o)?o:void 0}const widthCache=new Map,notRadius=t=>isNaN(t)||t<=0,fontsKey=t=>t.reduce(function(t,e){return t+=e.string},"");function isImageOrCanvas(t){if(t&&"object"==typeof t)return"[object HTMLImageElement]"===(t=t.toString())||"[object HTMLCanvasElement]"===t}function translate(t,{x:e,y:o},n){n&&(t.translate(e,o),t.rotate(toRadians(n)),t.translate(-e,-o))}function setBorderStyle(t,e){if(e&&e.borderWidth)return t.lineCap=e.borderCapStyle,t.setLineDash(e.borderDash),t.lineDashOffset=e.borderDashOffset,t.lineJoin=e.borderJoinStyle,t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,!0}function setShadowStyle(t,e){t.shadowColor=e.backgroundShadowColor,t.shadowBlur=e.shadowBlur,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY}function measureLabelSize(t,e){var o=e.content;if(isImageOrCanvas(o))return{width:getSize(o.width,e.width),height:getSize(o.height,e.height)};const n=e.font;var r=isArray(n)?n.map(t=>toFont(t)):[toFont(n)],e=e.textStrokeWidth;const i=isArray(o)?o:[o];o=i.join()+fontsKey(r)+e+(t._measureText?"-spriting":"");return widthCache.has(o)||widthCache.set(o,calculateLabelSize(t,i,r,e)),widthCache.get(o)}function drawBox(t,e,o){var{x:e,y:n,width:r,height:i}=e,a=(t.save(),setShadowStyle(t,o),setBorderStyle(t,o));t.fillStyle=o.backgroundColor,t.beginPath(),addRoundedRectPath(t,{x:e,y:n,w:r,h:i,radius:clampAll(toTRBLCorners(o.borderRadius),0,Math.min(r,i)/2)}),t.closePath(),t.fill(),a&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}function drawLabel(t,e,o){var n=o.content;if(isImageOrCanvas(n))return t.save(),t.globalAlpha=getOpacity(o.opacity,n.style.opacity),t.drawImage(n,e.x,e.y,e.width,e.height),void t.restore();n=isArray(n)?n:[n];const r=o.font;var i=isArray(r)?r.map(t=>toFont(t)):[toFont(r)],a=o.color,a=isArray(a)?a:[a],s=calculateTextAlignment(e,o),e=e.y+o.textStrokeWidth/2;t.save(),t.textBaseline="middle",t.textAlign=o.textAlign,setTextStrokeStyle(t,o)&&applyLabelDecoration(t,{x:s,y:e},n,i),applyLabelContent(t,{x:s,y:e},n,{fonts:i,colors:a}),t.restore()}function setTextStrokeStyle(t,e){if(0<e.textStrokeWidth)return t.lineJoin="round",t.miterLimit=2,t.lineWidth=e.textStrokeWidth,t.strokeStyle=e.textStrokeColor,!0}function drawPoint(t,e,o,n){var{radius:e,options:r}=e,i=r.pointStyle,r=r.rotation,a=(r||0)*RAD_PER_DEG;if(isImageOrCanvas(i))return t.save(),t.translate(o,n),t.rotate(a),t.drawImage(i,-i.width/2,-i.height/2,i.width,i.height),void t.restore();notRadius(e)||drawPointStyle(t,{x:o,y:n,radius:e,rotation:r,style:i,rad:a})}function drawPointStyle(t,{x:e,y:o,radius:n,rotation:r,style:i,rad:a}){let s,l,d,c;switch(t.beginPath(),i){default:t.arc(e,o,n,0,TAU),t.closePath();break;case"triangle":t.moveTo(e+Math.sin(a)*n,o-Math.cos(a)*n),a+=TWO_THIRDS_PI,t.lineTo(e+Math.sin(a)*n,o-Math.cos(a)*n),a+=TWO_THIRDS_PI,t.lineTo(e+Math.sin(a)*n,o-Math.cos(a)*n),t.closePath();break;case"rectRounded":c=.516*n,d=n-c,s=Math.cos(a+QUARTER_PI)*d,l=Math.sin(a+QUARTER_PI)*d,t.arc(e-s,o-l,c,a-PI,a-HALF_PI),t.arc(e+l,o-s,c,a-HALF_PI,a),t.arc(e+s,o+l,c,a,a+HALF_PI),t.arc(e-l,o+s,c,a+HALF_PI,a+PI),t.closePath();break;case"rect":if(!r){d=Math.SQRT1_2*n,t.rect(e-d,o-d,2*d,2*d);break}a+=QUARTER_PI;case"rectRot":s=Math.cos(a)*n,l=Math.sin(a)*n,t.moveTo(e-s,o-l),t.lineTo(e+l,o-s),t.lineTo(e+s,o+l),t.lineTo(e-l,o+s),t.closePath();break;case"crossRot":a+=QUARTER_PI;case"cross":s=Math.cos(a)*n,l=Math.sin(a)*n,t.moveTo(e-s,o-l),t.lineTo(e+s,o+l),t.moveTo(e+l,o-s),t.lineTo(e-l,o+s);break;case"star":s=Math.cos(a)*n,l=Math.sin(a)*n,t.moveTo(e-s,o-l),t.lineTo(e+s,o+l),t.moveTo(e+l,o-s),t.lineTo(e-l,o+s),a+=QUARTER_PI,s=Math.cos(a)*n,l=Math.sin(a)*n,t.moveTo(e-s,o-l),t.lineTo(e+s,o+l),t.moveTo(e+l,o-s),t.lineTo(e-l,o+s);break;case"line":s=Math.cos(a)*n,l=Math.sin(a)*n,t.moveTo(e-s,o-l),t.lineTo(e+s,o+l);break;case"dash":t.moveTo(e,o),t.lineTo(e+Math.cos(a)*n,o+Math.sin(a)*n)}t.fill()}function calculateLabelSize(e,o,n,r){e.save();var i=o.length;let a=0,s=r;for(let t=0;t<i;t++){var l=n[Math.min(t,n.length-1)],d=(e.font=l.string,o[t]);a=Math.max(a,e.measureText(d).width+r),s+=l.lineHeight}return e.restore(),{width:a,height:s}}function applyLabelDecoration(n,{x:r,y:i},t,a){n.beginPath();let s=0;t.forEach(function(t,e){var e=a[Math.min(e,a.length-1)],o=e.lineHeight;n.font=e.string,n.strokeText(t,r,i+o/2+s),s+=o}),n.stroke()}function applyLabelContent(r,{x:i,y:a},t,{fonts:s,colors:l}){let d=0;t.forEach(function(t,e){var o=l[Math.min(e,l.length-1)],e=s[Math.min(e,s.length-1)],n=e.lineHeight;r.beginPath(),r.font=e.string,r.fillStyle=o,r.fillText(t,i,a+n/2+d),d+=n,r.fill()})}function getOpacity(t,e){t=isNumber(t)?t:e;return isNumber(t)?clamp(t,0,1):1}const limitedLineScale={xScaleID:{min:"xMin",max:"xMax",start:"left",end:"right",startProp:"x",endProp:"x2"},yScaleID:{min:"yMin",max:"yMax",start:"bottom",end:"top",startProp:"y",endProp:"y2"}};function scaleValue(t,e,o){return e="number"==typeof e?e:t.parse(e),isFinite(e)?t.getPixelForValue(e):o}function retrieveScaleID(t,e,o){e=e[o];if(e||"scaleID"===o)return e;const n=o.charAt(0);e=Object.values(t).filter(t=>t.axis&&t.axis===n);return e.length?e[0].id:n}function getDimensionByScale(t,e){var o;if(t)return o=t.options.reverse,{start:scaleValue(t,e.min,o?e.end:e.start),end:scaleValue(t,e.max,o?e.start:e.end)}}function getChartPoint(t,e){var{chartArea:t,scales:o}=t,n=o[retrieveScaleID(o,e,"xScaleID")],o=o[retrieveScaleID(o,e,"yScaleID")];let r=t.width/2,i=t.height/2;return n&&(r=scaleValue(n,e.xValue,n.left+n.width/2)),o&&(i=scaleValue(o,e.yValue,o.top+o.height/2)),{x:r,y:i}}function resolveBoxProperties(t,e){var o=t.scales,n=o[retrieveScaleID(o,e,"xScaleID")],o=o[retrieveScaleID(o,e,"yScaleID")];if(!n&&!o)return{};var{left:r,right:i}=n||t.chartArea,{top:t,bottom:a}=o||t.chartArea,n=getChartDimensionByScale(n,{min:e.xMin,max:e.xMax,start:r,end:i}),r=n.start,i=n.end,n=getChartDimensionByScale(o,{min:e.yMin,max:e.yMax,start:a,end:t});return{x:r,y:t=n.start,x2:i,y2:a=n.end,width:i-r,height:a-t,centerX:r+(i-r)/2,centerY:t+(a-t)/2}}function resolvePointProperties(e,o){if(isBoundToPoint(o))return getChartCircle(e,o);{e=resolveBoxProperties(e,o);let t=o.radius;t&&!isNaN(t)||(t=Math.min(e.width,e.height)/2,o.radius=t);var n=2*t,r=e.centerX+o.xAdjust,e=e.centerY+o.yAdjust;return{x:r-t,y:e-t,x2:r+t,y2:e+t,centerX:r,centerY:e,width:n,height:n,radius:t}}}function resolveLineProperties(t,e){var{scales:t,chartArea:o}=t,n=t[e.scaleID],o={x:o.left,y:o.top,x2:o.right,y2:o.bottom};return n?resolveFullLineProperties(n,o,e):resolveLimitedLineProperties(t,o,e),o}function resolveBoxAndLabelProperties(t,e,o){const n=resolveBoxProperties(t,e);return n.initProperties=initAnimationProperties(t,n,e,o),n.elements=[{type:"label",optionScope:"label",properties:resolveLabelElementProperties$1(t,n,e),initProperties:n.initProperties}],n}function getChartCircle(t,e){var t=getChartPoint(t,e),o=2*e.radius;return{x:t.x-e.radius+e.xAdjust,y:t.y-e.radius+e.yAdjust,x2:t.x+e.radius+e.xAdjust,y2:t.y+e.radius+e.yAdjust,centerX:t.x+e.xAdjust,centerY:t.y+e.yAdjust,radius:e.radius,width:o,height:o}}function getChartDimensionByScale(t,e){t=getDimensionByScale(t,e)||e;return{start:Math.min(t.start,t.end),end:Math.max(t.start,t.end)}}function resolveFullLineProperties(t,e,o){var n=scaleValue(t,o.value,NaN),o=scaleValue(t,o.endValue,n);t.isHorizontal()?(e.x=n,e.x2=o):(e.y=n,e.y2=o)}function resolveLimitedLineProperties(t,e,o){for(const c of Object.keys(limitedLineScale)){var n,r,i,a,s,l,d=t[retrieveScaleID(t,o,c)];d&&({min:l,max:n,start:r,end:i,startProp:a,endProp:s}=limitedLineScale[c],l=getDimensionByScale(d,{min:o[l],max:o[n],start:d[r],end:d[i]}),e[a]=l.start,e[s]=l.end)}}function calculateX({properties:t,options:e},o,n,r){var{x:t,x2:i,width:a}=t;return calculatePosition$1({start:t,end:i,size:a,borderWidth:e.borderWidth},{position:n.x,padding:{start:r.left,end:r.right},adjust:e.label.xAdjust,size:o.width})}function calculateY({properties:t,options:e},o,n,r){var{y:t,y2:i,height:a}=t;return calculatePosition$1({start:t,end:i,size:a,borderWidth:e.borderWidth},{position:n.y,padding:{start:r.top,end:r.bottom},adjust:e.label.yAdjust,size:o.height})}function calculatePosition$1(t,e){var{start:t,end:o,borderWidth:n}=t,{position:r,padding:{start:i,end:a},adjust:s}=e;return t+n/2+s+getRelativePosition(o-n-t-i-a-e.size,r)}function resolveLabelElementProperties$1(t,e,o){const n=o.label;n.backgroundColor="transparent",n.callout.display=!1;var r=toPosition(n.position),i=toPadding(n.padding),t=measureLabelSize(t.ctx,n),a=calculateX({properties:e,options:o},t,r,i),e=calculateY({properties:e,options:o},t,r,i),o=t.width+i.width,r=t.height+i.height;return{x:a,y:e,x2:a+o,y2:e+r,width:o,height:r,centerX:a+o/2,centerY:e+r/2,rotation:n.rotation}}function rotated(t,e,o){var n=Math.cos(o),o=Math.sin(o),r=e.x,e=e.y;return{x:r+n*(t.x-r)-o*(t.y-e),y:e+o*(t.x-r)+n*(t.y-e)}}const moveHooks=["enter","leave"],eventHooks=moveHooks.concat("click");function updateListeners(t,o,e){o.listened=loadHooks(e,eventHooks,o.listeners),o.moveListened=!1,o._getElements=getElements,moveHooks.forEach(t=>{isFunction(e[t])&&(o.moveListened=!0)}),o.listened&&o.moveListened||o.annotations.forEach(e=>{!o.listened&&isFunction(e.click)&&(o.listened=!0),o.moveListened||moveHooks.forEach(t=>{isFunction(e[t])&&(o.listened=!0,o.moveListened=!0)})})}function handleEvent(t,e,o){if(t.listened)switch(e.type){case"mousemove":case"mouseout":return handleMoveEvents(t,e,o);case"click":return handleClickEvents(t,e,o)}}function handleMoveEvents(e,o,n){if(e.moveListened){let t;t="mousemove"===o.type?getElements(e,o,n.interaction):[];n=e.hovered,e=(e.hovered=t,{state:e,event:o}),o=dispatchMoveEvents(e,"leave",n,t);return dispatchMoveEvents(e,"enter",t,n)||o}}function dispatchMoveEvents({state:t,event:e},o,n,r){let i;for(const a of n)r.indexOf(a)<0&&(i=dispatchEvent(a.options[o]||t.listeners[o],a,e)||i);return i}function handleClickEvents(t,e,o){var n=t.listeners;let r;for(const i of getElements(t,e,o.interaction))r=dispatchEvent(i.options.click||n.click,i,e)||r;return r}function dispatchEvent(t,e,o){return!0===callback(t,[e.$context,o])}const elementHooks=["afterDraw","beforeDraw"];function updateHooks(t,o,e){const n=o.visibleElements;o.hooked=loadHooks(e,elementHooks,o.hooks),o.hooked||n.forEach(e=>{o.hooked||elementHooks.forEach(t=>{isFunction(e.options[t])&&(o.hooked=!0)})})}function invokeHook(t,e,o){if(t.hooked)return t=e.options[o]||t.hooks[o],callback(t,[e.$context])}function adjustScaleRange(t,e,o){t=getScaleLimits(t.scales,e,o);let n=changeScaleLimit(e,t,"min","suggestedMin");(n=changeScaleLimit(e,t,"max","suggestedMax")||n)&&isFunction(e.handleTickRangeOptions)&&e.handleTickRangeOptions()}function verifyScaleOptions(t,e){for(const o of t)verifyScaleIDs(o,e)}function changeScaleLimit(t,e,o,n){if(isFinite(e[o])&&!scaleLimitDefined(t.options,o,n))return n=t[o]!==e[o],t[o]=e[o],n}function scaleLimitDefined(t,e,o){return defined(t[e])||defined(t[o])}function verifyScaleIDs(t,e){for(const n of["scaleID","xScaleID","yScaleID"]){var o=retrieveScaleID(e,t,n);o&&!e[o]&&verifyProperties(t,n)&&console.warn(`No scale found with id '${o}' for annotation '${t.id}'`)}}function verifyProperties(t,e){if("scaleID"===e)return!0;var o=e.charAt(0);for(const n of["Min","Max","Value"])if(defined(t[o+n]))return!0;return!1}function getScaleLimits(t,e,o){var n=e.axis,r=e.id,i=n+"ScaleID",a={min:valueOrDefault(e.min,Number.NEGATIVE_INFINITY),max:valueOrDefault(e.max,Number.POSITIVE_INFINITY)};for(const s of o)s.scaleID===r?updateLimits(s,e,["value","endValue"],a):retrieveScaleID(t,s,i)===r&&updateLimits(s,e,[n+"Min",n+"Max",n+"Value"],a);return a}function updateLimits(t,e,o,n){for(const i of o){var r=t[i];defined(r)&&(r=e.parse(r),n.min=Math.min(n.min,r),n.max=Math.max(n.max,r))}}class BoxAnnotation extends Element{inRange(t,e,o,n){var{x:t,y:e}=rotated({x:t,y:e},this.getCenterPoint(n),toRadians(-this.options.rotation));return inBoxRange({x:t,y:e},this.getProps(["x","y","x2","y2"],n),o,this.options.borderWidth)}getCenterPoint(t){return getElementCenterPoint(this,t)}draw(t){t.save(),translate(t,this.getCenterPoint(),this.options.rotation),drawBox(t,this,this.options),t.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(t,e){return resolveBoxAndLabelProperties(t,e)}}BoxAnnotation.id="boxAnnotation",BoxAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,label:{backgroundColor:"transparent",borderWidth:0,callout:{display:!1},color:"black",content:null,display:!1,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,opacity:void 0,padding:6,position:"center",rotation:void 0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0,z:void 0},rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0},BoxAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"},BoxAnnotation.descriptors={label:{_fallback:!0}};const positions=["left","bottom","top","right"];class LabelAnnotation extends Element{inRange(t,e,o,n){var{x:t,y:e}=rotated({x:t,y:e},this.getCenterPoint(n),toRadians(-this.rotation));return inBoxRange({x:t,y:e},this.getProps(["x","y","x2","y2"],n),o,this.options.borderWidth)}getCenterPoint(t){return getElementCenterPoint(this,t)}draw(t){var e=this.options,o=!defined(this._visible)||this._visible;e.display&&e.content&&o&&(t.save(),translate(t,this.getCenterPoint(),this.rotation),drawCallout(t,this),drawBox(t,this,e),drawLabel(t,getLabelSize(this),e),t.restore())}resolveElementProperties(t,e){let o;o=isBoundToPoint(e)?getChartPoint(t,e):({centerX:n,centerY:r}=resolveBoxProperties(t,e),{x:n,y:r});var n=toPadding(e.padding),r=measureLabelSize(t.ctx,e),r=measureRect(o,r,e,n);return{initProperties:initAnimationProperties(t,r,e),pointX:o.x,pointY:o.y,...r,rotation:e.rotation}}}function measureRect(t,e,o,n){var r=e.width+n.width+o.borderWidth,e=e.height+n.height+o.borderWidth,n=toPosition(o.position,"center"),i=calculatePosition(t.x,r,o.xAdjust,n.x),t=calculatePosition(t.y,e,o.yAdjust,n.y);return{x:i,y:t,x2:i+r,y2:t+e,width:r,height:e,centerX:i+r/2,centerY:t+e/2}}function calculatePosition(t,e,o=0,n){return t-getRelativePosition(e,n)+o}function drawCallout(t,e){var{pointX:o,pointY:n,options:r}=e,i=r.callout,a=i&&i.display&&resolveCalloutPosition(e,i);if(a&&!isPointInRange(e,i,a)){if(t.save(),t.beginPath(),!setBorderStyle(t,i))return t.restore();var{separatorStart:s,separatorEnd:l}=getCalloutSeparatorCoord(e,a),{sideStart:a,sideEnd:d}=getCalloutSideCoord(e,a,s),i=((0<i.margin||0===r.borderWidth)&&(t.moveTo(s.x,s.y),t.lineTo(l.x,l.y)),t.moveTo(a.x,a.y),t.lineTo(d.x,d.y),rotated({x:o,y:n},e.getCenterPoint(),toRadians(-e.rotation)));t.lineTo(i.x,i.y),t.stroke(),t.restore()}}function getCalloutSeparatorCoord(t,e){var{x:o,y:n,x2:r,y2:i}=t,t=getCalloutSeparatorAdjust(t,e);let a,s;return s="left"===e||"right"===e?{x:(a={x:o+t,y:n}).x,y:i}:{x:r,y:(a={x:o,y:n+t}).y},{separatorStart:a,separatorEnd:s}}function getCalloutSeparatorAdjust(t,e){var{width:t,height:o,options:n}=t,n=n.callout.margin+n.borderWidth/2;return"right"===e?t+n:"bottom"===e?o+n:-n}function getCalloutSideCoord(t,e,o){var{y:t,width:n,height:r,options:i}=t,a=i.callout.start,i=getCalloutSideAdjust(e,i.callout);let s,l;return l="left"===e||"right"===e?{x:(s={x:o.x,y:t+getSize(r,a)}).x+i,y:s.y}:{x:(s={x:o.x+getSize(n,a),y:o.y}).x,y:s.y+i},{sideStart:s,sideEnd:l}}function getCalloutSideAdjust(t,e){e=e.side;return"left"===t||"top"===t?-e:e}function resolveCalloutPosition(t,e){var o=e.position;return positions.includes(o)?o:resolveCalloutAutoPosition(t,e)}function resolveCalloutAutoPosition(t,e){var{x:t,y:o,x2:n,y2:r,width:i,height:a,pointX:s,pointY:l,centerX:d,centerY:c,rotation:u}=t,h={x:d,y:c},d=e.start,c=getSize(i,d),p=[t,t+c,t+c,n],y=[o+getSize(a,d),r,o,r];const f=[];for(let t=0;t<4;t++){var v=rotated({x:p[t],y:y[t]},h,toRadians(u));f.push({position:positions[t],distance:distanceBetweenPoints(v,{x:s,y:l})})}return f.sort((t,e)=>t.distance-e.distance)[0].position}function getLabelSize({x:t,y:e,width:o,height:n,options:r}){var i=r.borderWidth/2,a=toPadding(r.padding);return{x:t+a.left+i,y:e+a.top+i,width:o-a.left-a.right-r.borderWidth,height:n-a.top-a.bottom-r.borderWidth}}function isPointInRange(t,e,o){var{pointX:n,pointY:r}=t,e=e.margin;let i=n,a=r;return"left"===o?i+=e:"right"===o?i-=e:"top"===o?a+=e:"bottom"===o&&(a-=e),t.inRange(i,a)}LabelAnnotation.id="labelAnnotation",LabelAnnotation.defaults={adjustScaleRange:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:0,callout:{borderCapStyle:"butt",borderColor:void 0,borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:1,display:!1,margin:5,position:"auto",side:5,start:"50%"},color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,init:void 0,opacity:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0},LabelAnnotation.defaultRoutes={borderColor:"color"};const pointInLine=(t,e,o)=>({x:t.x+o*(e.x-t.x),y:t.y+o*(e.y-t.y)}),interpolateX=(t,e,o)=>pointInLine(e,o,Math.abs((t-e.y)/(o.y-e.y))).x,interpolateY=(t,e,o)=>pointInLine(e,o,Math.abs((t-e.x)/(o.x-e.x))).y,sqr=t=>t*t,rangeLimit=(t,e,{x:o,y:n,x2:r,y2:i},a)=>"y"===a?{start:Math.min(n,i),end:Math.max(n,i),value:e}:{start:Math.min(o,r),end:Math.max(o,r),value:t},coordInCurve=(t,e,o,n)=>(1-n)*(1-n)*t+2*(1-n)*n*e+n*n*o,pointInCurve=(t,e,o,n)=>({x:coordInCurve(t.x,e.x,o.x,n),y:coordInCurve(t.y,e.y,o.y,n)}),coordAngleInCurve=(t,e,o,n)=>2*(1-n)*(e-t)+2*n*(o-e),angleInCurve=(t,e,o,n)=>-Math.atan2(coordAngleInCurve(t.x,e.x,o.x,n),coordAngleInCurve(t.y,e.y,o.y,n))+.5*PI;class LineAnnotation extends Element{inRange(t,e,o,n){var r=this.options.borderWidth/2;if("x"===o||"y"===o)return inAxisRange(this,{mouseX:t,mouseY:e},o,{hBorderWidth:r,useFinalPosition:n});{var i,o={mouseX:t,mouseY:e};const{path:a,ctx:s}=this;return a?(setBorderStyle(s,this.options),i=this.$context["chart"],t=t*i.currentDevicePixelRatio,e=e*i.currentDevicePixelRatio,i=s.isPointInStroke(a,t,e)||isOnLabel(this,o,n),s.restore(),i):intersects(this,o,sqr(r),n)||isOnLabel(this,o,n)}}getCenterPoint(t){return getElementCenterPoint(this,t)}draw(t){var{x:e,y:o,x2:n,y2:r,cp:i,options:a}=this;if(t.save(),!setBorderStyle(t,a))return t.restore();setShadowStyle(t,a);var s=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-o,2));if(a.curve&&i)return drawCurve(t,this,i,s),t.restore();var{startOpts:i,endOpts:l,startAdjust:d,endAdjust:c}=getArrowHeads(this),r=Math.atan2(r-o,n-e);t.translate(e,o),t.rotate(r),t.beginPath(),t.moveTo(0+d,0),t.lineTo(s-c,0),t.shadowColor=a.borderShadowColor,t.stroke(),drawArrowHead(t,0,d,i),drawArrowHead(t,s,-c,l),t.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(t,e){var o=resolveLineProperties(t,e),{x:n,y:r,x2:i,y2:a}=o,o=isLineInArea(o,t.chartArea);const s=o?limitLineToArea({x:n,y:r},{x:i,y:a},t.chartArea):{x:n,y:r,x2:i,y2:a,width:Math.abs(i-n),height:Math.abs(a-r)},l=(s.centerX=(i+n)/2,s.centerY=(a+r)/2,s.initProperties=initAnimationProperties(t,s,e),e.curve&&(i={x:s.x,y:s.y},n={x:s.x2,y:s.y2},s.cp=getControlPoint(s,e,distanceBetweenPoints(i,n))),resolveLabelElementProperties(t,s,e.label));return l._visible=o,s.elements=[{type:"label",optionScope:"label",properties:l,initProperties:s.initProperties}],s}}LineAnnotation.id="lineAnnotation";const arrowHeadsDefaults={backgroundColor:void 0,backgroundShadowColor:void 0,borderColor:void 0,borderDash:void 0,borderDashOffset:void 0,borderShadowColor:void 0,borderWidth:void 0,display:void 0,fill:void 0,length:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,width:void 0};function inAxisRange(t,{mouseX:e,mouseY:o},n,{hBorderWidth:r,useFinalPosition:i}){var a=rangeLimit(e,o,t.getProps(["x","y","x2","y2"],i),n);return a.value>=a.start-r&&a.value<=a.end+r||isOnLabel(t,{mouseX:e,mouseY:o},i,n)}function isLineInArea({x:t,y:e,x2:o,y2:n},{top:r,right:i,bottom:a,left:s}){return!(t<s&&o<s||i<t&&i<o||e<r&&n<r||a<e&&a<n)}function limitPointToArea({x:t,y:e},o,{top:n,right:r,bottom:i,left:a}){return t<a&&(e=interpolateY(a,{x:t,y:e},o),t=a),r<t&&(e=interpolateY(r,{x:t,y:e},o),t=r),e<n&&(t=interpolateX(n,{x:t,y:e},o),e=n),i<e&&(t=interpolateX(i,{x:t,y:e},o),e=i),{x:t,y:e}}function limitLineToArea(t,e,o){var{x:n,y:r}=limitPointToArea(t,e,o),{x:e,y:t}=limitPointToArea(e,t,o);return{x:n,y:r,x2:e,y2:t,width:Math.abs(e-n),height:Math.abs(t-r)}}function intersects(t,{mouseX:e,mouseY:o},n=EPSILON,r){var{x:t,y:r,x2:i,y2:a}=t.getProps(["x","y","x2","y2"],r),s=i-t,l=a-r,d=sqr(s)+sqr(l),d=0===d?-1:((e-t)*s+(o-r)*l)/d;let c,u;return u=d<0?(c=t,r):1<d?(c=i,a):(c=t+d*s,r+d*l),sqr(e-c)+sqr(o-u)<=n}function isOnLabel(t,{mouseX:e,mouseY:o},n,r){const i=t.label;return i.options.display&&i.inRange(e,o,r,n)}function resolveLabelElementProperties(t,e,o){var n=o.borderWidth,r=toPadding(o.padding),i=measureLabelSize(t.ctx,o);return calculateLabelPosition(e,o,{width:i.width+r.width+n,height:i.height+r.height+n,padding:r},t.chartArea)}function calculateAutoRotation(t){var{x:t,y:e,x2:o,y2:n}=t,n=Math.atan2(n-e,o-t);return PI/2<n?n-PI:n<PI/-2?n+PI:n}function calculateLabelPosition(t,e,o,n){var{width:o,height:r,padding:i}=o,{xAdjust:a,yAdjust:s}=e,l={x:t.x,y:t.y},d={x:t.x2,y:t.y2},c="auto"===e.rotation?calculateAutoRotation(t):toRadians(e.rotation),u=rotatedSize(o,r,c),e=calculateT(t,e,{labelSize:u,padding:i},n),t=t.cp?pointInCurve(l,t.cp,d,e):pointInLine(l,d,e),l={size:u.w,min:n.left,max:n.right,padding:i.left},d={size:u.h,min:n.top,max:n.bottom,padding:i.top},e=adjustLabelCoordinate(t.x,l)+a,u=adjustLabelCoordinate(t.y,d)+s;return{x:e-o/2,y:u-r/2,x2:e+o/2,y2:u+r/2,centerX:e,centerY:u,pointX:t.x,pointY:t.y,width:o,height:r,rotation:toDegrees(c)}}function rotatedSize(t,e,o){var n=Math.cos(o),o=Math.sin(o);return{w:Math.abs(t*n)+Math.abs(e*o),h:Math.abs(t*o)+Math.abs(e*n)}}function calculateT(t,e,o,n){let r;n=spaceAround(t,n);return r="start"===e.position?calculateTAdjust({w:t.x2-t.x,h:t.y2-t.y},o,e,n):"end"===e.position?1-calculateTAdjust({w:t.x-t.x2,h:t.y-t.y2},o,e,n):getRelativePosition(1,e.position)}function calculateTAdjust(t,e,o,n){var{labelSize:e,padding:r}=e,i=t.w*n.dx,t=t.h*n.dy,i=0<i&&(e.w/2+r.left-n.x)/i,e=0<t&&(e.h/2+r.top-n.y)/t;return clamp(Math.max(i,e),0,.25)}function spaceAround(t,e){var{x:t,x2:o,y:n,y2:r}=t,i=Math.min(n,r)-e.top,a=Math.min(t,o)-e.left,n=e.bottom-Math.max(n,r),r=e.right-Math.max(t,o);return{x:Math.min(a,r),y:Math.min(i,n),dx:a<=r?1:-1,dy:i<=n?1:-1}}function adjustLabelCoordinate(t,e){var{size:e,min:o,max:n,padding:r}=e,i=e/2;return n-o<e?(n+o)/2:n<=(t=t-r-i<=o?o+r+i:t)+r+i?n-r-i:t}function getArrowHeads(t){var e=t.options,o=e.arrowHeads&&e.arrowHeads.start,e=e.arrowHeads&&e.arrowHeads.end;return{startOpts:o,endOpts:e,startAdjust:getLineAdjust(t,o),endAdjust:getLineAdjust(t,e)}}function getLineAdjust(t,e){if(!e||!e.display)return 0;var{length:e,width:o}=e,t=t.options.borderWidth/2,e={x:e,y:o+t},o={x:0,y:t};return Math.abs(interpolateX(0,e,o))}function drawArrowHead(t,e,o,n){var r,i,a,s,l;n&&n.display&&({length:l,width:r,fill:i,backgroundColor:a,borderColor:s}=n,l=Math.abs(e-l)+o,t.beginPath(),setShadowStyle(t,n),setBorderStyle(t,n),t.moveTo(l,-r),t.lineTo(e+o,0),t.lineTo(l,r),!0===i?(t.fillStyle=a||s,t.closePath(),t.fill(),t.shadowColor="transparent"):t.shadowColor=n.borderShadowColor,t.stroke())}function getControlPoint(t,e,o){var{x:t,y:n,x2:r,y2:i,centerX:a,centerY:s}=t,i=Math.atan2(i-n,r-t),n=toPosition(e.controlPoint,0);return rotated({x:a+getSize(o,n.x,!1),y:s+getSize(o,n.y,!1)},{x:a,y:s},i)}function drawArrowHeadOnCurve(t,{x:e,y:o},{angle:n,adjust:r},i){i&&i.display&&(t.save(),t.translate(e,o),t.rotate(n),drawArrowHead(t,0,-r,i),t.restore())}function drawCurve(t,e,o,n){var{x:r,y:i,x2:a,y2:s,options:l}=e,{startOpts:d,endOpts:c,startAdjust:u,endAdjust:h}=getArrowHeads(e),r={x:r,y:i},i={x:a,y:s},a=angleInCurve(r,o,i,0),s=angleInCurve(r,o,i,1)-PI,p=pointInCurve(r,o,i,u/n),r=pointInCurve(r,o,i,1-h/n);const y=new Path2D;t.beginPath(),y.moveTo(p.x,p.y),y.quadraticCurveTo(o.x,o.y,r.x,r.y),t.shadowColor=l.borderShadowColor,t.stroke(y),e.path=y,drawArrowHeadOnCurve(e.ctx=t,p,{angle:a,adjust:u},d),drawArrowHeadOnCurve(t,r,{angle:s,adjust:h},c)}LineAnnotation.defaults={adjustScaleRange:!0,arrowHeads:{display:!1,end:Object.assign({},arrowHeadsDefaults),fill:!1,length:12,start:Object.assign({},arrowHeadsDefaults),width:6},borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:2,curve:!1,controlPoint:{y:"-50%"},display:!0,endValue:void 0,init:void 0,label:{backgroundColor:"rgba(0,0,0,0.8)",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderShadowColor:"transparent",borderWidth:0,callout:Object.assign({},LabelAnnotation.defaults.callout),color:"#fff",content:null,display:!1,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,opacity:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0,z:void 0},scaleID:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,value:void 0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0},LineAnnotation.descriptors={arrowHeads:{start:{_fallback:!0},end:{_fallback:!0},_fallback:!0}},LineAnnotation.defaultRoutes={borderColor:"color"};class EllipseAnnotation extends Element{inRange(t,e,o,n){var r=this.options.rotation,i=this.options.borderWidth;if("x"!==o&&"y"!==o)return pointInEllipse({x:t,y:e},this.getProps(["width","height","centerX","centerY"],n),r,i);var{x:a,y:s,x2:l,y2:d}=this.getProps(["x","y","x2","y2"],n),i=i/2,s="y"===o?{start:s,end:d}:{start:a,end:l},d=rotated({x:t,y:e},this.getCenterPoint(n),toRadians(-r));return d[o]>=s.start-i-EPSILON&&d[o]<=s.end+i+EPSILON}getCenterPoint(t){return getElementCenterPoint(this,t)}draw(t){var{width:e,height:o,centerX:n,centerY:r,options:i}=this,a=(t.save(),translate(t,this.getCenterPoint(),i.rotation),setShadowStyle(t,this.options),t.beginPath(),t.fillStyle=i.backgroundColor,setBorderStyle(t,i));t.ellipse(n,r,o/2,e/2,PI/2,0,2*PI),t.fill(),a&&(t.shadowColor=i.borderShadowColor,t.stroke()),t.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(t,e){return resolveBoxAndLabelProperties(t,e,!0)}}function pointInEllipse(t,e,o,n){var{width:e,height:r,centerX:i,centerY:a}=e,e=e/2,r=r/2;if(e<=0||r<=0)return!1;var o=toRadians(o||0),n=n/2||0,s=Math.cos(o),o=Math.sin(o),l=Math.pow(s*(t.x-i)+o*(t.y-a),2),o=Math.pow(o*(t.x-i)-s*(t.y-a),2);return l/Math.pow(e+n,2)+o/Math.pow(r+n,2)<=1.0001}EllipseAnnotation.id="ellipseAnnotation",EllipseAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,label:Object.assign({},BoxAnnotation.defaults.label),rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0},EllipseAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"},EllipseAnnotation.descriptors={label:{_fallback:!0}};class PointAnnotation extends Element{inRange(t,e,o,n){var{x:r,y:i,x2:a,y2:s,width:l}=this.getProps(["x","y","x2","y2","width"],n),d=this.options.borderWidth;if("x"!==o&&"y"!==o)return inPointRange({x:t,y:e},this.getCenterPoint(n),l/2,d);n=d/2,l="y"===o?{start:i,end:s,value:e}:{start:r,end:a,value:t};return l.start-n<=l.value&&l.value<=l.end+n}getCenterPoint(t){return getElementCenterPoint(this,t)}draw(t){const e=this.options;var o,n=e.borderWidth;e.radius<.1||(t.save(),t.fillStyle=e.backgroundColor,setShadowStyle(t,e),o=setBorderStyle(t,e),drawPoint(t,this,this.centerX,this.centerY),o&&!isImageOrCanvas(e.pointStyle)&&(t.shadowColor=e.borderShadowColor,t.stroke()),t.restore(),e.borderWidth=n)}resolveElementProperties(t,e){const o=resolvePointProperties(t,e);return o.initProperties=initAnimationProperties(t,o,e,!0),o}}PointAnnotation.id="pointAnnotation",PointAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,pointStyle:"circle",radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0},PointAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"};class PolygonAnnotation extends Element{inRange(t,e,o,n){if("x"!==o&&"y"!==o)return.1<=this.options.radius&&1<this.elements.length&&pointIsInPolygon(this.elements,t,e,n);t=rotated({x:t,y:e},this.getCenterPoint(n),toRadians(-this.options.rotation)),e=this.elements.map(t=>"y"===o?t.bY:t.bX),n=Math.min(...e),e=Math.max(...e);return t[o]>=n&&t[o]<=e}getCenterPoint(t){return getElementCenterPoint(this,t)}draw(t){var{elements:e,options:o}=this,n=(t.save(),t.beginPath(),t.fillStyle=o.backgroundColor,setShadowStyle(t,o),setBorderStyle(t,o));let r=!0;for(const i of e)r?(t.moveTo(i.x,i.y),r=!1):t.lineTo(i.x,i.y);t.closePath(),t.fill(),n&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(e,o){const n=resolvePointProperties(e,o);var{sides:r,rotation:t}=o;const i=[];var a=2*PI/r;let s=t*RAD_PER_DEG;for(let t=0;t<r;t++,s+=a){const l=buildPointElement(n,o,s);l.initProperties=initAnimationProperties(e,n,o),i.push(l)}return n.elements=i,n}}function buildPointElement({centerX:t,centerY:e},{radius:o,borderWidth:n},r){var n=n/2,i=Math.sin(r),r=Math.cos(r);const a=t+i*o,s=e-r*o;return{type:"point",optionScope:"point",properties:{x:a,y:s,centerX:a,centerY:s,bX:t+i*(o+n),bY:e-r*(o+n)}}}function pointIsInPolygon(t,e,o,n){let r=!1,i=t[t.length-1].getProps(["bX","bY"],n);for(const s of t){var a=s.getProps(["bX","bY"],n);a.bY>o!=i.bY>o&&e<(i.bX-a.bX)*(o-a.bY)/(i.bY-a.bY)+a.bX&&(r=!r),i=a}return r}PolygonAnnotation.id="polygonAnnotation",PolygonAnnotation.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,point:{radius:0},radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,sides:3,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0},PolygonAnnotation.defaultRoutes={borderColor:"color",backgroundColor:"color"};const annotationTypes={box:BoxAnnotation,ellipse:EllipseAnnotation,label:LabelAnnotation,line:LineAnnotation,point:PointAnnotation,polygon:PolygonAnnotation},directUpdater=(Object.keys(annotationTypes).forEach(t=>{defaults.describe("elements."+annotationTypes[t].id,{_fallback:"plugins.annotation.common"})}),{update:Object.assign}),hooks$1=eventHooks.concat(elementHooks),resolve=(t,e)=>isObject(e)?resolveObj(t,e):t,isIndexable=t=>"color"===t||"font"===t;function resolveType(t="line"){return annotationTypes[t]?t:(console.warn(`Unknown annotation type: '${t}', defaulting to 'line'`),"line")}function updateElements(e,t,o,n){const r=resolveAnimations(e,o.animations,n);var i=t.annotations,a=resyncElements(t.elements,i);for(let t=0;t<i.length;t++){const l=i[t],d=getOrCreateElement(a,t,l.type);var s=l.setContext(getContext(e,d,l));const c=d.resolveElementProperties(e,s);c.skip=toSkip(c),"elements"in c&&(updateSubElements(d,c.elements,s,r),delete c.elements),defined(d.x)||Object.assign(d,c),Object.assign(d,c.initProperties),c.options=resolveAnnotationOptions(s),r.update(d,c)}}function toSkip(t){return isNaN(t.x)||isNaN(t.y)}function resolveAnimations(t,e,o){return"reset"===o||"none"===o||"resize"===o?directUpdater:new Animations(t,e)}function updateSubElements(t,e,o,n){const r=t.elements||(t.elements=[]);r.length=e.length;for(let t=0;t<e.length;t++){var i=e[t];const s=i.properties;var a=getOrCreateElement(r,t,i.type,i.initProperties),i=o[i.optionScope].override(i);s.options=resolveAnnotationOptions(i),n.update(a,s)}}function getOrCreateElement(t,e,o,n){const r=annotationTypes[resolveType(o)];let i=t[e];return i&&i instanceof r||(i=t[e]=new r,Object.assign(i,n)),i}function resolveAnnotationOptions(t){var e=annotationTypes[resolveType(t.type)];const o={};o.id=t.id,o.type=t.type,o.drawTime=t.drawTime,Object.assign(o,resolveObj(t,e.defaults),resolveObj(t,e.defaultRoutes));for(const n of hooks$1)o[n]=t[n];return o}function resolveObj(t,e){const o={};for(const n of Object.keys(e)){const r=e[n],i=t[n];isIndexable(n)&&isArray(i)?o[n]=i.map(t=>resolve(t,r)):o[n]=resolve(i,r)}return o}function getContext(t,e,o){return e.$context||(e.$context=Object.assign(Object.create(t.getContext()),{element:e,id:o.id,type:"annotation"}))}function resyncElements(t,e){var e=e.length,o=t.length;return o<e?t.splice(o,0,...new Array(e-o)):e<o&&t.splice(e,o-e),t}var version="2.2.1";const chartStates=new Map,hooks=eventHooks.concat(elementHooks);var annotation={id:"annotation",version:version,beforeRegister(){requireVersion("chart.js","3.7",Chart.version)},afterRegister(){Chart.register(annotationTypes)},afterUnregister(){Chart.unregister(annotationTypes)},beforeInit(t){chartStates.set(t,{annotations:[],elements:[],visibleElements:[],listeners:{},listened:!1,moveListened:!1,hooks:{},hooked:!1,hovered:[]})},beforeUpdate(t,e,o){const n=chartStates.get(t),r=n.annotations=[];let i=o.annotations;isObject(i)?Object.keys(i).forEach(t=>{const e=i[t];isObject(e)&&(e.id=t,r.push(e))}):isArray(i)&&r.push(...i),verifyScaleOptions(r,t.scales)},afterDataLimits(t,e){const o=chartStates.get(t);adjustScaleRange(t,e.scale,o.annotations.filter(t=>t.display&&t.adjustScaleRange))},afterUpdate(t,e,o){const n=chartStates.get(t);updateListeners(t,n,o),updateElements(t,n,o,e.mode),n.visibleElements=n.elements.filter(t=>!t.skip&&t.options.display),updateHooks(t,n,o)},beforeDatasetsDraw(t,e,o){draw(t,"beforeDatasetsDraw",o.clip)},afterDatasetsDraw(t,e,o){draw(t,"afterDatasetsDraw",o.clip)},beforeDraw(t,e,o){draw(t,"beforeDraw",o.clip)},afterDraw(t,e,o){draw(t,"afterDraw",o.clip)},beforeEvent(t,e,o){handleEvent(chartStates.get(t),e.event,o)&&(e.changed=!0)},afterDestroy(t){chartStates.delete(t)},_getState(t){return chartStates.get(t)},defaults:{animations:{numbers:{properties:["x","y","x2","y2","width","height","centerX","centerY","pointX","pointY","radius"],type:"number"}},clip:!0,interaction:{mode:void 0,axis:void 0,intersect:void 0},common:{drawTime:"afterDatasetsDraw",init:!1,label:{}}},descriptors:{_indexable:!1,_scriptable:t=>!hooks.includes(t)&&"init"!==t,annotations:{_allKeys:!1,_fallback:(t,e)=>"elements."+annotationTypes[resolveType(e.type)].id},interaction:{_fallback:!0},common:{label:{_indexable:isIndexable,_fallback:!0},_indexable:isIndexable}},additionalOptionScopes:[""]};function draw(t,e,o){var{ctx:n,chartArea:r}=t,i=chartStates.get(t),t=(o&&clipArea(n,r),getDrawableElements(i.visibleElements,e).sort((t,e)=>t.element.options.z-e.element.options.z));for(const a of t)drawElement(n,r,i,a);o&&unclipArea(n)}function getDrawableElements(t,e){const o=[];for(const n of t)if(n.options.drawTime===e&&o.push({element:n,main:!0}),n.elements&&n.elements.length)for(const r of n.elements)r.options.display&&r.options.drawTime===e&&o.push({element:r});return o}function drawElement(t,e,o,n){const r=n.element;n.main?(invokeHook(o,r,"beforeDraw"),r.draw(t,e),invokeHook(o,r,"afterDraw")):r.draw(t,e)}export{annotation as default};